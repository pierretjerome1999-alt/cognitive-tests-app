<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tests Cognitifs - Aisance Num√©rique</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 600px;
            width: 100%;
            padding: 40px;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            text-align: center;
            font-size: 28px;
        }

        .subtitle {
            color: #666;
            text-align: center;
            margin-bottom: 30px;
            font-size: 14px;
        }

        #correctCount {
            display: none;
        }

        .stats.show-score #correctCount {
            display: inline;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 30px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 8px;
            font-size: 14px;
        }

        .stat {
            text-align: center;
        }

        .stat-label {
            color: #666;
            display: block;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: #667eea;
        }

        .screen {
            display: none;
            text-align: center;
            animation: fadeIn 0.3s ease-in;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .operation {
            font-size: 36px;
            font-weight: bold;
            color: #333;
            margin: 40px 0;
            padding: 30px;
            background: #f9f9f9;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .instruction {
            color: #666;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .comparison-screen {
            padding: 20px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 30px;
        }

        button {
            padding: 12px 30px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 80px;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        .btn-answer {
            background: #667eea;
            color: white;
            flex: 1;
        }

        .btn-answer:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }

        .btn-answer.active {
            background: #764ba2;
            transform: scale(1.05);
        }

        .btn-next {
            background: #28a745;
            color: white;
            margin-top: 20px;
            width: 100%;
        }

        .btn-next:hover {
            background: #218838;
        }

        .btn-restart {
            background: #6c757d;
            color: white;
            margin-top: 20px;
            width: 100%;
        }

        .btn-restart:hover {
            background: #5a6268;
        }

        .btn-back {
            background: #6c757d;
            color: white;
            margin-top: 20px;
            width: 100%;
        }

        .btn-back:hover {
            background: #5a6268;
        }

        .test-selection-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin: 20px 0;
        }

        .btn-test {
            background: #667eea;
            color: white;
            padding: 25px;
            font-size: 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            font-weight: 600;
        }

        .btn-test:hover {
            background: #764ba2;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-test.empty {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-test.empty:hover {
            background: #999;
            transform: none;
        }

        .timer {
            font-size: 12px;
            color: #999;
            margin-top: 10px;
        }

        .result {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .result.show {
            display: block;
        }

        .result-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .result-text {
            font-size: 18px;
            color: #333;
            margin-bottom: 20px;
        }

        .result.correct {
            background: #d4edda;
            border-left: 4px solid #28a745;
        }

        .result.incorrect {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: #ddd;
            border-radius: 2px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s ease;
        }

        .summary {
            display: none;
            text-align: center;
        }

        .summary.show {
            display: block;
        }

        .summary-score {
            font-size: 48px;
            font-weight: bold;
            color: #667eea;
            margin: 20px 0;
        }

        .summary-details {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            font-size: 14px;
        }

        .summary-details p {
            margin: 10px 0;
        }

        .answers-recap {
            text-align: left;
            margin: 20px 0;
            background: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            max-height: 400px;
            overflow-y: auto;
        }

        .answer-row {
            display: grid;
            grid-template-columns: 50px 1fr 80px 80px;
            gap: 10px;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid #eee;
            font-size: 13px;
        }

        .answer-row:last-child {
            border-bottom: none;
        }

        .answer-num {
            font-weight: bold;
            color: #666;
            text-align: center;
        }

        .answer-operations {
            font-family: 'Courier New', monospace;
            color: #333;
        }

        .answer-choices {
            display: flex;
            gap: 6px;
            justify-content: flex-end;
        }

        .choice {
            width: 50px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            font-weight: bold;
            font-size: 12px;
        }

        .choice.user {
            background: #fff;
            border: 2px solid #ccc;
            color: #333;
        }

        .choice.user.correct {
            background: #28a745;
            color: white;
            border-color: #28a745;
        }

        .choice.user.incorrect {
            background: #dc3545;
            color: white;
            border-color: #dc3545;
        }

        .choice.correct {
            background: #28a745;
            color: white;
            border: 2px solid #28a745;
        }

        .answer-card {
            background: #f9f9f9;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        .answer-card:hover {
            border-color: #667eea;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
            transform: translateY(-2px);
        }

        .answer-card.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .arrow-pair {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .arrow-label {
            font-size: 12px;
            color: #666;
        }

        .answer-card.selected .arrow-label {
            color: white;
        }

        /* Styles sp√©cifiques Test 4 */
        .premise-box {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            border-left: 4px solid #667eea;
        }

        .premise-text {
            font-size: 18px;
            color: #333;
            font-weight: 500;
        }

        .question-box {
            background: #e8f4f8;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #17a2b8;
        }

        .question-text {
            font-size: 20px;
            color: #333;
            font-weight: bold;
        }

        .reasoning-choices {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin: 25px 0;
        }

        .reasoning-choice {
            background: #f9f9f9;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 16px;
            font-weight: 500;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        .reasoning-choice:hover {
            border-color: #667eea;
            background: #f0f0ff;
            transform: translateY(-2px);
        }

        .reasoning-choice.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        /* Styles sp√©cifiques Test 5 */
        .string-box {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 25px;
            margin: 15px 0;
            font-family: 'Courier New', Consolas, monospace;
            font-size: 22px;
            letter-spacing: 1px;
            word-break: break-all;
        }

        .string-box.original {
            border-left: 4px solid #28a745;
            background: #f0fff0;
        }

        .string-box.copy {
            border-left: 4px solid #fd7e14;
            background: #fff8f0;
        }

        .string-label {
            font-size: 12px;
            color: #666;
            font-family: 'Segoe UI', sans-serif;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .error-count-choices {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 30px 0;
        }

        .error-count-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #f9f9f9;
            border: 3px solid #ddd;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        .error-count-btn:hover {
            border-color: #667eea;
            background: #f0f0ff;
            transform: scale(1.1);
        }

        .error-count-btn.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
            transform: scale(1.1);
        }

        .char-diff {
            color: #dc3545;
            background: #ffe0e0;
            padding: 0 2px;
            border-radius: 2px;
        }

        /* ===== RESPONSIVE MOBILE ===== */
        @media screen and (max-width: 600px) {
            body {
                padding: 10px;
                align-items: flex-start;
            }

            .container {
                padding: 20px 15px;
                border-radius: 8px;
                margin-top: 10px;
            }

            h1 {
                font-size: 22px;
                margin-bottom: 8px;
            }

            h2 {
                font-size: 18px;
            }

            .subtitle {
                font-size: 12px;
                margin-bottom: 20px;
            }

            .stats {
                padding: 10px;
                font-size: 12px;
                gap: 5px;
            }

            .stat-value {
                font-size: 16px;
            }

            /* Boutons g√©n√©raux */
            button {
                padding: 10px 20px;
                font-size: 14px;
                min-width: 60px;
            }

            .btn-test {
                padding: 18px 15px;
                font-size: 15px;
            }

            .btn-test span {
                font-size: 11px !important;
            }

            .btn-answer {
                padding: 15px !important;
                font-size: 16px !important;
            }

            .button-group {
                gap: 8px;
                flex-wrap: wrap;
            }

            /* Test 1 - Op√©rations */
            .operation {
                font-size: 24px;
                padding: 20px 15px;
                margin: 25px 0;
            }

            /* Test 2 - Orientation spatiale */
            .instruction-box {
                padding: 15px 10px;
            }

            .rule-line {
                font-size: 14px !important;
            }

            .arrow-grid {
                gap: 10px !important;
            }

            .answer-card {
                min-height: 80px;
                padding: 6px;
            }

            .arrow-pair {
                font-size: 22px;
            }

            .arrow-label {
                font-size: 10px;
            }

            /* Test 3 - M√©moire des mots */
            .word-display {
                font-size: 28px !important;
            }

            .words-grid {
                gap: 10px !important;
            }

            .word-card {
                padding: 12px 8px !important;
                font-size: 14px !important;
            }

            /* Test 4 - Raisonnement */
            .premise-box {
                padding: 15px;
                margin: 10px 0;
            }

            .premise-text {
                font-size: 15px;
            }

            .question-box {
                padding: 15px;
                margin: 15px 0;
            }

            .question-text {
                font-size: 17px;
            }

            .reasoning-choice {
                padding: 12px 15px;
                font-size: 14px;
            }

            /* Test 5 - Comparaison */
            .string-box {
                padding: 18px 12px;
                font-size: 16px;
                letter-spacing: 0.5px;
            }

            .string-label {
                font-size: 10px;
            }

            .error-count-choices {
                gap: 10px;
                margin: 20px 0;
            }

            .error-count-btn {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }

            /* R√©capitulatif des r√©ponses */
            .answers-recap {
                padding: 10px;
                max-height: 350px;
            }

            .answer-row {
                grid-template-columns: 35px 1fr;
                grid-template-rows: auto auto;
                gap: 5px;
                padding: 10px 8px;
                font-size: 11px;
            }

            .answer-num {
                font-size: 12px;
            }

            .answer-operations {
                font-size: 11px;
                grid-column: 2;
            }

            .answer-choices {
                grid-column: 1 / -1;
                justify-content: center;
                margin-top: 8px;
            }

            .choice {
                width: 45px;
                height: 55px;
                font-size: 10px;
            }

            .summary-score {
                font-size: 36px;
            }

            .summary-details {
                padding: 15px;
                font-size: 13px;
            }

            /* Recap Test 2 arrows */
            .recap-arrows {
                font-size: 20px !important;
            }

            /* Recap Test 4 */
            .recap-premise {
                font-size: 12px !important;
            }

            .recap-question {
                font-size: 13px !important;
            }

            /* Recap Test 5 strings */
            .recap-string {
                font-size: 12px !important;
                word-break: break-all;
            }
        }

        /* ===== TR√àS PETITS √âCRANS ===== */
        @media screen and (max-width: 380px) {
            .container {
                padding: 15px 10px;
            }

            h1 {
                font-size: 18px;
            }

            .operation {
                font-size: 20px;
                padding: 15px 10px;
            }

            .string-box {
                font-size: 14px;
                padding: 15px 10px;
            }

            .error-count-btn {
                width: 42px;
                height: 42px;
                font-size: 18px;
            }

            .btn-test {
                padding: 15px 12px;
                font-size: 14px;
            }

            .arrow-pair {
                font-size: 18px;
            }

            .answer-card {
                min-height: 70px;
            }
        }
    
    /* Styles pour le bouton X et le modal */
    #exitButton {
        position: fixed;
        top: 15px;
        left: 15px;
        background-color: #ff4444;
        color: white;
        border: none;
        border-radius: 50%;
        width: 45px;
        height: 45px;
        font-size: 28px;
        cursor: pointer;
        z-index: 10000;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        font-weight: bold;
    }
    #exitButton:hover {
        background-color: #cc0000;
    }
    
    #exitModal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.5);
        z-index: 9999;
        justify-content: center;
        align-items: center;
    }
    
    #exitModal.show {
        display: flex;
    }
    
    .exitModalContent {
        background-color: white;
        padding: 30px;
        border-radius: 10px;
        text-align: center;
        min-width: 300px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }
    
    .exitModalContent h2 {
        margin-top: 0;
        color: #333;
        margin-bottom: 20px;
    }
    
    .exitModalButtons {
        display: flex;
        gap: 15px;
        justify-content: center;
        margin-top: 20px;
    }
    
    .exitModalButtons button {
        padding: 10px 30px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        font-weight: bold;
    }
    
    .exitModalButtons button:first-child {
        background-color: #999;
        color: white;
    }
    
    .exitModalButtons button:first-child:hover {
        background-color: #777;
    }
    
    .exitModalButtons button:last-child {
        background-color: #4CAF50;
        color: white;
    }
    
    .exitModalButtons button:last-child:hover {
        background-color: #45a049;
    }

    </style>
</head>
<body>
<button id="exitButton" onclick="openExitMenu()">‚úï</button>

    <div class="container">
        <h1 id="mainTitle">üìã Choix des tests</h1>
        <p class="subtitle">Tests d'entra√Ænement cognitif</p>

        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <div class="stats">
            <div class="stat">
                <span class="stat-label">Question</span>
                <span class="stat-value"><span id="currentQuestion">1</span><span id="questionsSeparator">/</span><span id="totalQuestions">10</span></span>
            </div>
            <div class="stat" id="correctStat" style="display: none;">
                <span class="stat-label">Correctes</span>
                <span class="stat-value" id="correctCount">0</span>
            </div>
            <div class="stat">
                <span class="stat-label">Temps</span>
                <span class="stat-value" id="timeDisplay">0s</span>
            </div>
        </div>

        <!-- √âcran 0 : S√©lection du test -->
        <div class="screen active" id="screen0">
            <h2 style="margin-bottom: 30px; color: #333;">Tests Cognitifs</h2>
            <p class="subtitle" style="margin-bottom: 30px;">S√©lectionnez un test</p>
            <div class="test-selection-grid">
                <button class="btn-test" onclick="goToTestMenu(1)">
                    üßÆ TEST D'AISANCE NUMERIQUE<br><span style="font-size: 12px; opacity: 0.9;">Calcul et m√©moire num√©rique</span>
                </button>
                <button class="btn-test" onclick="goToTestMenu(2)">
                    üìê TEST D'ORIENTATION SPATIALE<br><span style="font-size: 12px; opacity: 0.9;">Analyse de patterns</span>
                </button>
                <button class="btn-test" onclick="goToTestMenu(3)">
                    üî§ TEST DE M√âMOIRE DES MOTS<br><span style="font-size: 12px; opacity: 0.9;">R√©tention et compr√©hension</span>
                </button>
                <button class="btn-test" onclick="goToTestMenu(4)">
                    üß† TEST DE RAISONNEMENT<br><span style="font-size: 12px; opacity: 0.9;">Logique et d√©duction</span>
                </button>
                <button class="btn-test" onclick="goToTestMenu(5)">
                    üîç TEST DE COMPARAISON<br><span style="font-size: 12px; opacity: 0.9;">D√©tection d'erreurs</span>
                </button>
                <button class="btn-test empty" disabled>
                    ‚öôÔ∏è Test 6<br><span style="font-size: 12px; opacity: 0.9;">√Ä venir...</span>
                </button>
            </div>
        </div>

        <!-- √âcran 1 : Choix du nombre de questions -->
        <div class="screen" id="screen1">
            <h2 style="margin-bottom: 30px; color: #333;">Choix de la difficult√©</h2>
            <p class="subtitle" style="margin-bottom: 30px;">Aisance Num√©rique</p>
            <div style="display: flex; flex-direction: column; gap: 15px;">
                <button class="btn-answer" onclick="startTest(10, 'questions')" style="padding: 20px; font-size: 18px;">
                    üü¢ 10 questions
                </button>
                <button class="btn-answer" onclick="startTest(20, 'questions')" style="padding: 20px; font-size: 18px;">
                    üü° 20 questions
                </button>
                <button class="btn-answer" onclick="startTest(50, 'questions')" style="padding: 20px; font-size: 18px;">
                    üî¥ 50 questions
                </button>
                <button class="btn-answer" onclick="startTest(180, 'time')" style="padding: 20px; font-size: 18px;">
                    ‚è±Ô∏è 3 minutes
                </button>
                <button class="btn-answer" onclick="startTest(540, 'time')" style="padding: 20px; font-size: 18px;">
                    ‚è±Ô∏è 9 minutes
                </button>
            </div>
            <button class="btn-back" onclick="showScreen(0)">‚Üê Retour</button>
        </div>

        <!-- √âcran 2 : Premi√®re op√©ration -->
        <div class="screen" id="screen2">
            <p class="instruction">Calculez mentalement et m√©morisez la solution</p>
            <div class="operation" id="operation1"></div>
            <button class="btn-answer btn-next" onclick="goToScreen2()">‚ûú Suivant</button>
        </div>

        <!-- √âcran 3 : Deuxi√®me op√©ration -->
        <div class="screen" id="screen3">
            <p class="instruction">Calculez mentalement et m√©morisez cette deuxi√®me solution</p>
            <div class="operation" id="operation2"></div>
            <button class="btn-answer btn-next" onclick="goToScreen3()">‚ûú Comparer</button>
        </div>

        <!-- √âcran 4 : Comparaison -->
        <div class="screen" id="screen4">
            <p class="instruction">Comparez les deux op√©rations</p>
            <div class="comparison-screen">
                <p style="color: #666; margin-bottom: 20px;">Comparez les deux solutions m√©moris√©es</p>
                <div class="button-group">
                    <button class="btn-answer" onclick="selectAnswer('S')" id="btnS">
                        Sup√©rieure<br><span style="font-size: 12px;">(S)</span>
                    </button>
                    <button class="btn-answer" onclick="selectAnswer('I')" id="btnI">
                        Inf√©rieure<br><span style="font-size: 12px;">(I)</span>
                    </button>
                    <button class="btn-answer" onclick="selectAnswer('E')" id="btnE">
                        √âgales<br><span style="font-size: 12px;">(E)</span>
                    </button>
                </div>
            </div>

            <div class="result" id="result">
                <div class="result-icon" id="resultIcon"></div>
                <div class="result-text" id="resultText"></div>
            </div>

            <button class="btn-next" id="nextBtn" onclick="nextQuestion()" style="display: none;">‚ûú Suivant</button>
        </div>

        <!-- √âcran 7 : Choix du nombre de questions pour Test 2 -->
        <div class="screen" id="screen7">
            <h2 style="margin-bottom: 30px; color: #333;">Choix de la difficult√©</h2>
            <p class="subtitle" style="margin-bottom: 30px;">Orientation Spatiale</p>
            <div style="display: flex; flex-direction: column; gap: 15px;">
                <button class="btn-answer" onclick="startTest2(10, 'questions')" style="padding: 20px; font-size: 18px;">
                    üü¢ 10 questions
                </button>
                <button class="btn-answer" onclick="startTest2(20, 'questions')" style="padding: 20px; font-size: 18px;">
                    üü° 20 questions
                </button>
                <button class="btn-answer" onclick="startTest2(50, 'questions')" style="padding: 20px; font-size: 18px;">
                    üî¥ 50 questions
                </button>
                <button class="btn-answer" onclick="startTest2(180, 'time')" style="padding: 20px; font-size: 18px;">
                    ‚è±Ô∏è 3 minutes
                </button>
                <button class="btn-answer" onclick="startTest2(540, 'time')" style="padding: 20px; font-size: 18px;">
                    ‚è±Ô∏è 9 minutes
                </button>
            </div>
            <button class="btn-back" onclick="showScreen(0)">‚Üê Retour</button>
        </div>

        <!-- √âcran 8 : Affichage de la r√®gle pour Test 2 -->
        <div class="screen" id="screen8">
            <p class="instruction">M√©morisez cette r√®gle</p>
            <div style="background: #f9f9f9; padding: 30px; border-radius: 8px; margin: 30px 0; border-left: 4px solid #667eea;">
                <div id="ruleLine1" style="font-size: 18px; font-weight: bold; color: #333; margin-bottom: 15px;"></div>
                <div id="ruleLine2" style="font-size: 18px; font-weight: bold; color: #333;"></div>
            </div>
            <button class="btn-answer btn-next" onclick="goToScreen9()">‚ûú Suivant</button>
        </div>

        <!-- √âcran 9 : Grille de s√©lection des 6 r√©ponses pour Test 2 -->
        <div class="screen" id="screen9">
            <p class="instruction">S√©lectionnez la paire de fl√®ches qui correspond √† la r√®gle</p>
            <div id="answersGrid" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin: 30px 0;"></div>
            <button class="btn-next" id="nextBtn2" onclick="nextQuestion2()" style="display: none;">‚ûú Suivant</button>
        </div>

        <!-- √âcran 10 : Menu Test 3 - Choix de la difficult√© -->
        <div class="screen" id="screen10">
            <h2 style="margin-bottom: 30px; color: #333;">Choix de la difficult√©</h2>
            <p class="subtitle" style="margin-bottom: 30px;">Test de M√©moire des Mots</p>
            <div style="display: flex; flex-direction: column; gap: 15px;">
                <button class="btn-answer" onclick="startTest3(10, 'questions')" style="padding: 20px; font-size: 18px;">
                    üü¢ 10 questions
                </button>
                <button class="btn-answer" onclick="startTest3(20, 'questions')" style="padding: 20px; font-size: 18px;">
                    üü° 20 questions
                </button>
                <button class="btn-answer" onclick="startTest3(50, 'questions')" style="padding: 20px; font-size: 18px;">
                    üî¥ 50 questions
                </button>
                <button class="btn-answer" onclick="startTest3(180, 'time')" style="padding: 20px; font-size: 18px;">
                    üü¢ 3 minutes
                </button>
                <button class="btn-answer" onclick="startTest3(540, 'time')" style="padding: 20px; font-size: 18px;">
                    üü† 9 minutes
                </button>
            </div>
            <button class="btn-back" onclick="showScreen(0)" style="margin-top: 20px;">‚Ü© Retour</button>
        </div>

        <!-- √âcran 11 : Consignes Test 3 -->
        <div class="screen" id="screen11">
            <h2 style="text-align: center; margin-bottom: 20px; color: #333;">R√®gles √† retenir</h2>
            <div id="rulesDisplay" style="background: #f5f5f5; padding: 25px; border-radius: 8px; margin: 20px 0; font-size: 18px; text-align: center; color: #333; line-height: 1.8;">
            </div>
            <button class="btn-next" onclick="goToScreen12()" style="margin-top: 30px;">‚ûú Afficher les mots</button>
        </div>

        <!-- √âcran 12 : Questions Test 3 -->
        <div class="screen" id="screen12">
            <p class="instruction">Comparez les mots avec les r√®gles. Combien correspondent ?</p>
            <div id="wordsDisplay" style="display: flex; justify-content: center; gap: 30px; background: #f5f5f5; padding: 25px; border-radius: 8px; margin: 20px 0; font-size: 20px; text-align: center; color: #333; font-weight: bold; flex-wrap: wrap;"></div>
            <div style="display: flex; gap: 15px; justify-content: center; margin: 30px 0;">
                <button class="btn-answer" onclick="selectAnswer3(0)" style="font-size: 20px; padding: 15px 30px; width: auto;">0</button>
                <button class="btn-answer" onclick="selectAnswer3(1)" style="font-size: 20px; padding: 15px 30px; width: auto;">1</button>
                <button class="btn-answer" onclick="selectAnswer3(2)" style="font-size: 20px; padding: 15px 30px; width: auto;">2</button>
                <button class="btn-answer" onclick="selectAnswer3(3)" style="font-size: 20px; padding: 15px 30px; width: auto;">3</button>
            </div>
            <button class="btn-next" id="nextBtn3" onclick="nextQuestion3()" style="display: none; margin-top: 20px;">‚ûú Suivant</button>
        </div>

        <!-- √âcran 13 : Menu Test 4 - Choix de la difficult√© -->
        <div class="screen" id="screen13">
            <h2 style="margin-bottom: 30px; color: #333;">Choix de la difficult√©</h2>
            <p class="subtitle" style="margin-bottom: 30px;">Test de Raisonnement</p>
            <div style="display: flex; flex-direction: column; gap: 15px;">
                <button class="btn-answer" onclick="startTest4(10, 'questions')" style="padding: 20px; font-size: 18px;">
                    üü¢ 10 questions
                </button>
                <button class="btn-answer" onclick="startTest4(20, 'questions')" style="padding: 20px; font-size: 18px;">
                    üü° 20 questions
                </button>
                <button class="btn-answer" onclick="startTest4(50, 'questions')" style="padding: 20px; font-size: 18px;">
                    üî¥ 50 questions
                </button>
                <button class="btn-answer" onclick="startTest4(180, 'time')" style="padding: 20px; font-size: 18px;">
                    ‚è±Ô∏è 3 minutes
                </button>
                <button class="btn-answer" onclick="startTest4(540, 'time')" style="padding: 20px; font-size: 18px;">
                    ‚è±Ô∏è 9 minutes
                </button>
            </div>
            <button class="btn-back" onclick="showScreen(0)" style="margin-top: 20px;">‚Ü© Retour</button>
        </div>

        <!-- √âcran 14 : Questions Test 4 -->
        <div class="screen" id="screen14">
            <p class="instruction">Lisez les deux pr√©misses et r√©pondez √† la question</p>
            
            <div class="premise-box">
                <div class="premise-text" id="premise1"></div>
            </div>
            
            <div class="premise-box">
                <div class="premise-text" id="premise2"></div>
            </div>
            
            <div class="question-box">
                <div class="question-text" id="reasoningQuestion"></div>
            </div>
            
            <div class="reasoning-choices" id="reasoningChoices">
                <!-- Les choix seront g√©n√©r√©s dynamiquement -->
            </div>
            
            <button class="btn-next" id="nextBtn4" onclick="nextQuestion4()" style="display: none; margin-top: 20px;">‚ûú Suivant</button>
        </div>

        <!-- √âcran 15 : Menu Test 5 - Choix de la difficult√© -->
        <div class="screen" id="screen15">
            <h2 style="margin-bottom: 30px; color: #333;">Choix de la difficult√©</h2>
            <p class="subtitle" style="margin-bottom: 30px;">Test de Comparaison de Cha√Ænes</p>
            <div style="display: flex; flex-direction: column; gap: 15px;">
                <button class="btn-answer" onclick="startTest5(10, 'questions')" style="padding: 20px; font-size: 18px;">
                    üü¢ 10 questions
                </button>
                <button class="btn-answer" onclick="startTest5(20, 'questions')" style="padding: 20px; font-size: 18px;">
                    üü° 20 questions
                </button>
                <button class="btn-answer" onclick="startTest5(50, 'questions')" style="padding: 20px; font-size: 18px;">
                    üî¥ 50 questions
                </button>
                <button class="btn-answer" onclick="startTest5(180, 'time')" style="padding: 20px; font-size: 18px;">
                    ‚è±Ô∏è 3 minutes
                </button>
                <button class="btn-answer" onclick="startTest5(540, 'time')" style="padding: 20px; font-size: 18px;">
                    ‚è±Ô∏è 9 minutes
                </button>
            </div>
            <button class="btn-back" onclick="showScreen(0)" style="margin-top: 20px;">‚Ü© Retour</button>
        </div>

        <!-- √âcran 16 : Affichage des deux cha√Ænes (Test 5 - √âtape 1) -->
        <div class="screen" id="screen16">
            <p class="instruction">Comparez les deux cha√Ænes et comptez les diff√©rences</p>
            
            <div class="string-box original">
                <div class="string-label">Cha√Æne originale</div>
                <div id="originalString"></div>
            </div>
            
            <div class="string-box copy">
                <div class="string-label">Cha√Æne √† v√©rifier</div>
                <div id="copyString"></div>
            </div>
            
            <button class="btn-answer btn-next" onclick="goToScreen17()" style="margin-top: 30px;">‚ûú √âtape suivante</button>
        </div>

        <!-- √âcran 17 : Choix du nombre d'erreurs (Test 5 - √âtape 2) -->
        <div class="screen" id="screen17">
            <p class="instruction">Combien d'erreurs avez-vous identifi√©es ?</p>
            
            <div class="error-count-choices" id="errorCountChoices">
                <button class="error-count-btn" onclick="selectAnswer5(0)">0</button>
                <button class="error-count-btn" onclick="selectAnswer5(1)">1</button>
                <button class="error-count-btn" onclick="selectAnswer5(2)">2</button>
                <button class="error-count-btn" onclick="selectAnswer5(3)">3</button>
                <button class="error-count-btn" onclick="selectAnswer5(4)">4</button>
            </div>
            
            <button class="btn-next" id="nextBtn5" onclick="nextQuestion5()" style="display: none; margin-top: 20px;">‚ûú Suivant</button>
        </div>

        <!-- R√©sum√© final -->
        <div class="summary" id="summary">
            <h2>Test Termin√©! üéâ</h2>
            <div class="summary-score" id="finalScore">10/10</div>
            <p id="scorePercentage"></p>
            <div class="summary-details">
                <p><strong>Temps total :</strong> <span id="totalTime">0s</span></p>
                <p><strong>Temps moyen par question :</strong> <span id="avgTime">0s</span></p>
                <p id="encouragement"></p>
            </div>
            <div class="answers-recap" id="answersRecap"></div>
            <button class="btn-restart" onclick="restartTest()">üîÑ Recommencer</button>
        </div>
    </div>

    <script>
        let TOTAL_QUESTIONS = 10;
        let currentQuestion = 1;
        let score = 0;
        let startTime = Date.now();
        let operation1 = {};
        let operation2 = {};
        let userAnswer = null;
        let answersHistory = [];
        let timerInterval = null;
        let currentTest = 1;
        
        // Variables pour Test 1 (mode temps)
        let test1Mode = 'questions';
        let test1TimeLimit = 0;
        let test1TimeRemaining = 0;
        let test1ElapsedTime = 0;
        
        // Variables pour Test 2
        let currentRule = null;
        let correctAnswer2 = null;
        let userAnswer2 = null;
        let test2Answers = [];
        
        // Variables pour Test 2 (mode temps)
        let test2Mode = 'questions';
        let test2TimeLimit = 0;
        let test2TimeRemaining = 0;
        let test2ElapsedTime = 0;

        // Variables pour Test 3
        let test3Themes = [];
        let test3Words = [];
        let test3CorrectCount = 0;
        let test3CorrectPositions = new Set();
        let userAnswer3 = null;
        let test3Answers = [];
        let test3ThemesList = [];
        let test3Mode = 'questions';
        let test3TimeLimit = 0;
        let test3TimeRemaining = 0;
        let test3ElapsedTime = 0;
        const test3ThemesData = {"themes": {"PAYS": ["France", "Espagne", "Italie", "Allemagne", "Belgique", "Suisse", "Angleterre", "Irlande", "Portugal", "Gr√®ce", "Pologne", "Tch√©quie", "Hongrie", "Roumanie", "Bulgarie", "Serbie", "Croatie", "Slov√©nie", "Autriche", "Su√®de", "Norv√®ge", "Danemark", "Finlande", "Islande", "Russie", "Ukraine", "Canada", "√âtats-Unis", "Mexique", "Br√©sil", "Argentine", "Chili", "P√©rou", "Colombie", "Venezuela", "Japon", "Chine", "Cor√©e", "Tha√Ølande", "Vietnam"], "V√äTEMENTS": ["Chemise", "T-shirt", "Pantalon", "Jean", "Jupe", "Robe", "Veste", "Manteau", "Pull", "Cardigan", "Gilet", "Chaussette", "Collant", "Ceinture", "√âcharpe", "Foulard", "Bonnet", "Chapeau", "Casquette", "B√©ret", "Gants", "Moufles", "Chaussure", "Baskets", "Mocassins", "Sandales", "Bottes", "Bottines", "Short", "Bermuda", "Costume", "Parka", "Doudoune", "Blouson", "Poncho"], "FRUITS": ["Pomme", "Poire", "P√™che", "Abricot", "Prune", "Raisin", "Fraise", "Framboise", "M√ªre", "Myrtille", "Groseille", "Cassis", "Cerise", "Banane", "Orange", "Citron", "Cl√©mentine", "Mandarine", "Pamplemousse", "Ananas", "Kiwi", "Figue", "Datte", "Grenade", "Mangue", "Papaye", "Litchi", "Past√®que", "Melon", "Amande", "Noix", "Noisette"], "ANIMAUX": ["Chat", "Chien", "Souris", "Rat", "Hamster", "Lapin", "√âcureuil", "L√©opard", "Tigre", "Lion", "Puma", "Jaguar", "Lynx", "Loup", "Renard", "Blaireau", "Loutre", "Phoque", "Vache", "Taureau", "Brebis", "Agneau", "Ch√®vre", "Cochon", "Cheval", "√Çne", "Chameau", "Girafe", "Z√®bre", "√âl√©phant", "Rhinoc√©ros", "Hippopotame", "Kangourou", "Koala", "Panda", "Ours", "Gorille", "Singe", "Aigle", "Faucon", "Hibou", "Chouette", "Perroquet", "Canari", "Corbeau", "Pie", "Moineau", "Pigeon", "Canard", "Oie", "Cygne", "Flamant", "Pingouin", "Dauphin", "Baleine", "Requin", "Tortue", "Crocodile", "Serpent", "L√©zard"]}};

        // Variables pour Test 4
        let test4Mode = 'questions';
        let test4TimeLimit = 0;
        let test4TimeRemaining = 0;
        let test4ElapsedTime = 0;
        let test4Answers = [];
        let userAnswer4 = null;
        let currentTest4Question = null;

        // Donn√©es pour Test 4
        const test4Data = {
            themes: {
                animaux: ["le chat", "le chien", "la souris", "le lapin", "l'√©l√©phant", "la girafe", "le lion", "le tigre", "l'ours", "le loup", "le renard", "le cochon", "la vache", "le cheval", "l'√¢ne", "le mouton", "la ch√®vre", "le canard", "la poule", "le coq", "l'aigle", "le hibou", "le serpent", "la tortue", "le dauphin", "la baleine", "le requin", "le singe", "le z√®bre", "l'hippopotame"],
                vehicules: ["la voiture", "le v√©lo", "la moto", "le bus", "le train", "l'avion", "l'h√©licopt√®re", "le bateau", "le camion", "le tracteur", "la trottinette", "le scooter", "le m√©tro", "le tramway", "le taxi", "l'ambulance", "le ferry", "le yacht", "le sous-marin", "la fus√©e"],
                personnes: ["Sophie", "Marc", "L√©a", "Thomas", "Emma", "Lucas", "Julie", "Pierre", "Marie", "Paul", "Laura", "Nicolas", "Sarah", "Antoine", "Claire", "Maxime", "Alice", "Hugo", "Camille", "Louis", "Chlo√©", "Gabriel", "Manon", "Rapha√´l", "In√®s"],
                fruits: ["la pomme", "la poire", "la banane", "l'orange", "le citron", "la fraise", "la cerise", "le raisin", "l'ananas", "la past√®que", "le melon", "la p√™che", "l'abricot", "la prune", "la mangue", "le kiwi", "la figue", "la grenade", "la noix de coco", "la papaye"],
                objets: ["le livre", "la table", "la chaise", "le t√©l√©phone", "l'ordinateur", "la lampe", "le stylo", "le cahier", "le sac", "la montre", "les lunettes", "le parapluie", "la bouteille", "l'assiette", "le verre", "la tasse", "le couteau", "la fourchette", "la cuill√®re", "le miroir"],
                villes: ["Paris", "Lyon", "Marseille", "Bordeaux", "Lille", "Nantes", "Toulouse", "Nice", "Strasbourg", "Montpellier", "Rennes", "Grenoble", "Dijon", "Angers", "Reims", "Toulon", "Le Havre", "Saint-√âtienne", "Brest", "Clermont-Ferrand"],
                sports: ["le football", "le tennis", "le basketball", "la natation", "le cyclisme", "la course", "le ski", "le golf", "le rugby", "le volleyball", "le handball", "la boxe", "le judo", "l'escrime", "la gymnastique", "le surf", "l'escalade", "le patinage", "le badminton", "le ping-pong"]
            },
            attributs: [
                { positif: "rapide", negatif: "lent", questionPositif: "le plus rapide", questionNegatif: "le plus lent", genre: "m" },
                { positif: "grand", negatif: "petit", questionPositif: "le plus grand", questionNegatif: "le plus petit", genre: "m" },
                { positif: "lourd", negatif: "l√©ger", questionPositif: "le plus lourd", questionNegatif: "le plus l√©ger", genre: "m" },
                { positif: "cher", negatif: "bon march√©", questionPositif: "le plus cher", questionNegatif: "le moins cher", genre: "m" },
                { positif: "vieux", negatif: "jeune", questionPositif: "le plus vieux", questionNegatif: "le plus jeune", genre: "m" },
                { positif: "long", negatif: "court", questionPositif: "le plus long", questionNegatif: "le plus court", genre: "m" },
                { positif: "haut", negatif: "bas", questionPositif: "le plus haut", questionNegatif: "le plus bas", genre: "m" },
                { positif: "fort", negatif: "faible", questionPositif: "le plus fort", questionNegatif: "le plus faible", genre: "m" },
                { positif: "intelligent", negatif: "b√™te", questionPositif: "le plus intelligent", questionNegatif: "le plus b√™te", genre: "m" },
                { positif: "bruyant", negatif: "silencieux", questionPositif: "le plus bruyant", questionNegatif: "le plus silencieux", genre: "m" }
            ]
        };

        // Variables pour Test 5
        let test5Mode = 'questions';
        let test5TimeLimit = 0;
        let test5TimeRemaining = 0;
        let test5ElapsedTime = 0;
        let test5Answers = [];
        let userAnswer5 = null;
        let currentTest5Question = null;

        // Directions et couleurs pour Test 2
        const directions = ['‚Üñ', '‚Üó', '‚Üô', '‚Üò'];
        const directionNames = {
            '‚Üñ': 'Haut Gauche',
            '‚Üó': 'Haut Droit',
            '‚Üô': 'Bas Gauche',
            '‚Üò': 'Bas Droit'
        };
        const colors = ['Blanc', 'Noir'];
        const relations = ['AU-DESSUS', 'AU-DESSOUS'];
        const relationNames = {
            'AU-DESSUS': 'AU-DESSUS de',
            'AU-DESSOUS': 'AU-DESSOUS de'
        };

        // Fonction utilitaire pour formater les secondes
        function formatSeconds(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            if (mins > 0) {
                return `${mins}m ${secs}s`;
            }
            return `${secs}s`;
        }

        function goToTestMenu(testNum) {
            currentTest = testNum;
            if (testNum === 1) {
                showScreen(1);
            } else if (testNum === 2) {
                showScreen(7);
            } else if (testNum === 3) {
                showScreen(10);
            } else if (testNum === 4) {
                showScreen(13);
            } else if (testNum === 5) {
                showScreen(15);
            }
        }

        function startTest(value, mode) {
            test1Mode = mode;
            currentQuestion = 1;
            score = 0;
            answersHistory = [];
            startTime = Date.now();
            userAnswer = null;
            
            clearInterval(timerInterval);
            
            if (mode === 'questions') {
                TOTAL_QUESTIONS = value;
                test1TimeLimit = 999999;
                document.getElementById('questionsSeparator').style.display = 'inline';
                document.getElementById('totalQuestions').style.display = 'inline';
                document.getElementById('totalQuestions').textContent = value;
                test1ElapsedTime = 0;
                document.getElementById('timeDisplay').textContent = '0s';
                timerInterval = setInterval(() => updateElapsedTimer1(), 1000);
            } else if (mode === 'time') {
                test1TimeLimit = value;
                test1TimeRemaining = value;
                TOTAL_QUESTIONS = 9999;
                document.getElementById('questionsSeparator').style.display = 'none';
                document.getElementById('totalQuestions').style.display = 'none';
                document.getElementById('timeDisplay').textContent = formatSeconds(test1TimeRemaining);
                timerInterval = setInterval(() => updateCountdownTimer1(), 1000);
            }

            document.getElementById('currentQuestion').textContent = '1';
            document.getElementById('correctCount').textContent = '0';

            showScreen(2);
            newQuestion();
        }
        
        function updateElapsedTimer1() {
            test1ElapsedTime++;
            document.getElementById('timeDisplay').textContent = formatSeconds(test1ElapsedTime);
        }
        
        function updateCountdownTimer1() {
            if (test1TimeRemaining > 0) {
                test1TimeRemaining--;
            }
            
            document.getElementById('timeDisplay').textContent = formatSeconds(test1TimeRemaining);
            
            if (test1TimeRemaining <= 0) {
                clearInterval(timerInterval);
                endTest1();
            }
        }
        
        function endTest1() {
            // Valide la r√©ponse en cours si une s√©lection a √©t√© faite
            if (userAnswer !== null) {
                validateAnswer();
            }
            TOTAL_QUESTIONS = currentQuestion - 1;
            if (TOTAL_QUESTIONS < 1) TOTAL_QUESTIONS = 1;
            showSummary();
        }

        function startTest2(value, mode) {
            test2Mode = mode;
            currentQuestion = 1;
            score = 0;
            test2Answers = [];
            startTime = Date.now();
            userAnswer2 = null;
            
            clearInterval(timerInterval);
            
            if (mode === 'questions') {
                TOTAL_QUESTIONS = value;
                test2TimeLimit = 999999;
                document.getElementById('questionsSeparator').style.display = 'inline';
                document.getElementById('totalQuestions').style.display = 'inline';
                document.getElementById('totalQuestions').textContent = value;
                test2ElapsedTime = 0;
                document.getElementById('timeDisplay').textContent = '0s';
                timerInterval = setInterval(() => updateElapsedTimer2(), 1000);
            } else if (mode === 'time') {
                test2TimeLimit = value;
                test2TimeRemaining = value;
                TOTAL_QUESTIONS = 9999;
                document.getElementById('questionsSeparator').style.display = 'none';
                document.getElementById('totalQuestions').style.display = 'none';
                document.getElementById('timeDisplay').textContent = formatSeconds(test2TimeRemaining);
                timerInterval = setInterval(() => updateCountdownTimer2(), 1000);
            }

            document.getElementById('currentQuestion').textContent = '1';
            document.getElementById('correctCount').textContent = '0';

            showScreen(8);
            newQuestion2();
        }
        
        function updateElapsedTimer2() {
            test2ElapsedTime++;
            document.getElementById('timeDisplay').textContent = formatSeconds(test2ElapsedTime);
        }
        
        function updateCountdownTimer2() {
            if (test2TimeRemaining > 0) {
                test2TimeRemaining--;
            }
            
            document.getElementById('timeDisplay').textContent = formatSeconds(test2TimeRemaining);
            
            if (test2TimeRemaining <= 0) {
                clearInterval(timerInterval);
                endTest2();
            }
        }
        
        function endTest2() {
            TOTAL_QUESTIONS = currentQuestion - 1;
            if (TOTAL_QUESTIONS < 1) TOTAL_QUESTIONS = 1;
            showSummary2();
        }

        // G√©n√©rateur d'op√©rations al√©atoires
        function generateOperation(minResult = 5, maxResult = 100) {
            const operators = ['+', '-', '*', '√∑'];
            let operator, a, b, result;
            let isValid = false;

            while (!isValid) {
                operator = operators[Math.floor(Math.random() * operators.length)];
                
                if (operator === '+') {
                    a = Math.floor(Math.random() * 80) + 5;
                    b = Math.floor(Math.random() * 80) + 5;
                    result = a + b;
                } else if (operator === '-') {
                    a = Math.floor(Math.random() * 80) + 20;
                    b = Math.floor(Math.random() * a);
                    result = a - b;
                } else if (operator === '*') {
                    a = Math.floor(Math.random() * 15) + 2;
                    b = Math.floor(Math.random() * 15) + 2;
                    result = a * b;
                } else if (operator === '√∑') {
                    b = Math.floor(Math.random() * 10) + 2;
                    a = b * (Math.floor(Math.random() * 12) + 2);
                    result = a / b;
                }

                isValid = result >= minResult && result <= maxResult && result > 0;
            }

            return {
                a,
                b,
                operator,
                result: Math.floor(result),
                display: `${a} ${operator} ${b}`
            };
        }

        function generatePair() {
            let op1 = generateOperation(5, 100);
            let op2;
            
            const targetRange = 15;
            const minResult = Math.max(5, op1.result - targetRange);
            const maxResult = Math.min(100, op1.result + targetRange);
            
            const random = Math.random();
            
            if (random < 0.33) {
                do {
                    op2 = generateOperation(op1.result, op1.result);
                } while (op2.a === op1.a && op2.b === op1.b && op2.operator === op1.operator);
            } else if (random < 0.66) {
                do {
                    op2 = generateOperation(minResult, maxResult);
                } while (op2.result === op1.result);
            } else {
                do {
                    op2 = generateOperation(minResult, maxResult);
                } while (op2.result === op1.result);
            }

            return { op1, op2 };
        }

        // ===== TEST 2 : ORIENTATION SPATIALE =====

        function generateRule() {
            // Choisir 2 directions et 2 couleurs al√©atoires
            const direction1 = directions[Math.floor(Math.random() * directions.length)];
            const direction2 = directions[Math.floor(Math.random() * directions.length)];
            const color1 = colors[Math.floor(Math.random() * colors.length)];
            const color2 = colors[Math.floor(Math.random() * colors.length)];
            
            // Choisir al√©atoirement la relation pour les couleurs (50% AU-DESSUS, 50% AU-DESSOUS)
            const colorRelation = relations[Math.floor(Math.random() * relations.length)];
            // Choisir al√©atoirement la relation pour les directions (50% AU-DESSUS, 50% AU-DESSOUS)
            const dirRelation = relations[Math.floor(Math.random() * relations.length)];
            
            // D√©terminer les couleurs des fl√®ches selon la relation
            // arrow1 = fl√®che du HAUT, arrow2 = fl√®che du BAS
            // "X AU-DESSUS de Y" ‚Üí X en haut, Y en bas
            // "X AU-DESSOUS de Y" ‚Üí Y en haut, X en bas
            let topColor, bottomColor;
            if (colorRelation === 'AU-DESSUS') {
                topColor = color1;      // color1 est au-dessus
                bottomColor = color2;   // color2 est en-dessous
            } else {
                topColor = color2;      // color2 est au-dessus (car color1 est en-dessous)
                bottomColor = color1;   // color1 est en-dessous
            }
            
            // D√©terminer les directions des fl√®ches selon la relation
            let topDirection, bottomDirection;
            if (dirRelation === 'AU-DESSUS') {
                topDirection = direction1;    // direction1 est au-dessus
                bottomDirection = direction2; // direction2 est en-dessous
            } else {
                topDirection = direction2;    // direction2 est au-dessus (car direction1 est en-dessous)
                bottomDirection = direction1; // direction1 est en-dessous
            }
            
            const arrow1 = { direction: topDirection, color: topColor };       // Fl√®che du HAUT
            const arrow2 = { direction: bottomDirection, color: bottomColor }; // Fl√®che du BAS
            
            // Cr√©er les lignes de consigne avec les relations appropri√©es
            const dirLine = `${directionNames[direction1]} ${relationNames[dirRelation]} ${directionNames[direction2]}`;
            const colorLine = `${color1} ${relationNames[colorRelation]} ${color2}`;
            
            // Alterner l'ordre des consignes al√©atoirement
            const colorFirst = Math.random() < 0.5;
            const line1 = colorFirst ? colorLine : dirLine;
            const line2 = colorFirst ? dirLine : colorLine;
            
            return {
                arrow1,
                arrow2,
                colorRelation,
                dirRelation,
                line1,
                line2
            };
        }

        function countChanges(correct, candidate) {
            let changes = 0;
            if (correct.arrow1.direction !== candidate.arrow1.direction) changes++;
            if (correct.arrow1.color !== candidate.arrow1.color) changes++;
            if (correct.arrow2.direction !== candidate.arrow2.direction) changes++;
            if (correct.arrow2.color !== candidate.arrow2.color) changes++;
            return changes;
        }

        function isHomogeneousChange(correct, candidate) {
            const dir1Change = correct.arrow1.direction !== candidate.arrow1.direction;
            const dir2Change = correct.arrow2.direction !== candidate.arrow2.direction;
            const col1Change = correct.arrow1.color !== candidate.arrow1.color;
            const col2Change = correct.arrow2.color !== candidate.arrow2.color;
            
            return (dir1Change || dir2Change) && !(col1Change || col2Change) ||
                   (col1Change || col2Change) && !(dir1Change || dir2Change);
        }

        function generateIncorrectAnswers(correctAnswer) {
            const candidates = [];
            
            for (let d1 of directions) {
                for (let c1 of colors) {
                    for (let d2 of directions) {
                        for (let c2 of colors) {
                            const candidate = {
                                arrow1: { direction: d1, color: c1 },
                                arrow2: { direction: d2, color: c2 }
                            };
                            if (!(d1 === correctAnswer.arrow1.direction && c1 === correctAnswer.arrow1.color &&
                                  d2 === correctAnswer.arrow2.direction && c2 === correctAnswer.arrow2.color)) {
                                candidates.push(candidate);
                            }
                        }
                    }
                }
            }
            
            candidates.sort((a, b) => {
                const changesA = countChanges(correctAnswer, a);
                const changesB = countChanges(correctAnswer, b);
                return changesA - changesB;
            });
            
            const incorrectAnswers = [];
            const maxAttempts = candidates.length * 2;
            let attempts = 0;
            
            while (incorrectAnswers.length < 8 && attempts < maxAttempts) {
                const candidate = candidates[Math.floor(Math.random() * candidates.length)];
                
                const alreadyExists = incorrectAnswers.some(ans => 
                    ans.arrow1.direction === candidate.arrow1.direction &&
                    ans.arrow1.color === candidate.arrow1.color &&
                    ans.arrow2.direction === candidate.arrow2.direction &&
                    ans.arrow2.color === candidate.arrow2.color
                );
                
                if (alreadyExists) {
                    attempts++;
                    continue;
                }
                
                const changes = countChanges(correctAnswer, candidate);
                let probability = 0;
                
                if (changes === 1) {
                    probability = 0.45;
                } else if (changes === 2) {
                    const isHomogeneous = isHomogeneousChange(correctAnswer, candidate);
                    probability = isHomogeneous ? 0.22 : 0.13;
                } else if (changes === 3) {
                    probability = 0.15;
                } else if (changes === 4) {
                    probability = 0.05;
                }
                
                if (Math.random() < probability) {
                    incorrectAnswers.push(candidate);
                }
                
                attempts++;
            }
            
            const usedAnswers = new Set(incorrectAnswers.map(a => 
                `${a.arrow1.direction}${a.arrow1.color}${a.arrow2.direction}${a.arrow2.color}`
            ));
            
            while (incorrectAnswers.length < 5) {
                const candidate = candidates[Math.floor(Math.random() * candidates.length)];
                const key = `${candidate.arrow1.direction}${candidate.arrow1.color}${candidate.arrow2.direction}${candidate.arrow2.color}`;
                if (!usedAnswers.has(key)) {
                    incorrectAnswers.push(candidate);
                    usedAnswers.add(key);
                }
            }
            
            return incorrectAnswers.slice(0, 5);
        }

        function newQuestion2() {
            currentRule = generateRule();
            correctAnswer2 = {
                arrow1: currentRule.arrow1,
                arrow2: currentRule.arrow2
            };
            
            document.getElementById('ruleLine1').textContent = currentRule.line1;
            document.getElementById('ruleLine2').textContent = currentRule.line2;
        }

        function goToScreen9() {
            const incorrectAnswers = generateIncorrectAnswers(correctAnswer2).slice(0, 5);
            const allAnswers = [correctAnswer2, ...incorrectAnswers];
            
            for (let i = allAnswers.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [allAnswers[i], allAnswers[j]] = [allAnswers[j], allAnswers[i]];
            }
            
            const grid = document.getElementById('answersGrid');
            grid.innerHTML = '';
            grid.style.gridTemplateColumns = '1fr 1fr';
            grid.style.gap = '12px';
            
            allAnswers.forEach((answer, index) => {
                const card = document.createElement('div');
                card.className = 'answer-card';
                
                const createArrowSVG = (direction, color) => {
                    const isWhite = color === 'Blanc';
                    const fill = isWhite ? 'white' : 'black';
                    const stroke = isWhite ? 'black' : 'white';
                    
                    const angles = {
                        '‚Üñ': 315,
                        '‚Üó': 45,
                        '‚Üô': 225,
                        '‚Üò': 135
                    };
                    const angle = angles[direction];
                    
                    return `
                        <svg width="45" height="45" viewBox="0 0 60 60" style="transform: rotate(${angle}deg);">
                            <polygon points="30,5 50,40 40,40 40,55 20,55 20,40 10,40" 
                                fill="${fill}" stroke="${stroke}" stroke-width="2"/>
                        </svg>
                    `;
                };
                
                card.innerHTML = `
                    <div style="display: flex; flex-direction: column; align-items: center; gap: 8px;">
                        <div>${createArrowSVG(answer.arrow1.direction, answer.arrow1.color)}</div>
                        <div>${createArrowSVG(answer.arrow2.direction, answer.arrow2.color)}</div>
                    </div>
                `;
                card.onclick = () => selectAnswer2(index, answer, card);
                grid.appendChild(card);
            });
            
            showScreen(9);
            userAnswer2 = null;
        }

        function selectAnswer2(index, answer, card) {
            document.querySelectorAll('.answer-card').forEach(c => c.classList.remove('selected'));
            card.classList.add('selected');
            
            userAnswer2 = answer;
            document.getElementById('nextBtn2').style.display = 'block';
        }

        function nextQuestion2() {
            const isCorrect = userAnswer2 && 
                userAnswer2.arrow1.direction === correctAnswer2.arrow1.direction &&
                userAnswer2.arrow1.color === correctAnswer2.arrow1.color &&
                userAnswer2.arrow2.direction === correctAnswer2.arrow2.direction &&
                userAnswer2.arrow2.color === correctAnswer2.arrow2.color;
            
            if (isCorrect) score++;
            
            test2Answers.push({
                question: currentQuestion,
                rule: { line1: currentRule.line1, line2: currentRule.line2 },
                userAnswer: userAnswer2,
                correctAnswer: correctAnswer2,
                isCorrect: isCorrect
            });
            
            currentQuestion++;
            document.getElementById('currentQuestion').textContent = currentQuestion;
            
            if (currentQuestion > TOTAL_QUESTIONS) {
                showSummary2();
            } else {
                newQuestion2();
                showScreen(8);
                document.getElementById('nextBtn2').style.display = 'none';
                userAnswer2 = null;
            }
        }

        function showSummary2() {
            if (timerInterval) clearInterval(timerInterval);
            
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('summary').classList.add('show');
            document.querySelector('.stats').classList.add('show-score');
            
            document.getElementById('currentQuestion').textContent = TOTAL_QUESTIONS;
            
            const totalTime = Math.floor((Date.now() - startTime) / 1000);
            const avgTime = Math.floor(totalTime / TOTAL_QUESTIONS);
            const percentage = Math.round((score / TOTAL_QUESTIONS) * 100);
            
            document.getElementById('finalScore').textContent = `${score}/${TOTAL_QUESTIONS}`;
            document.getElementById('scorePercentage').textContent = `${percentage}% de r√©ussite`;
            document.getElementById('totalTime').textContent = totalTime + 's';
            document.getElementById('avgTime').textContent = avgTime + 's';
            
            let encouragement = '';
            if (percentage === 100) {
                encouragement = 'üåü Parfait ! Vous ma√Ætrisez ce test.';
            } else if (percentage >= 80) {
                encouragement = 'üëè Tr√®s bien ! Continuez √† vous entra√Æner.';
            } else if (percentage >= 60) {
                encouragement = 'üí™ Bien ! Des progr√®s encore possibles.';
            } else {
                encouragement = 'üìö Continuez vos entra√Ænements pour progresser.';
            }
            document.getElementById('encouragement').textContent = encouragement;
            
            displayAnswersRecap2();
        }

        function displayAnswersRecap2() {
            const createArrowSVG = (direction, color, size = 30) => {
                const isWhite = color === 'Blanc';
                const fill = isWhite ? 'white' : 'black';
                const stroke = isWhite ? 'black' : 'white';
                
                const angles = {
                    '‚Üñ': 315,
                    '‚Üó': 45,
                    '‚Üô': 225,
                    '‚Üò': 135
                };
                const angle = angles[direction];
                
                return `
                    <svg width="${size}" height="${size}" viewBox="0 0 60 60" style="transform: rotate(${angle}deg); display: block;">
                        <polygon points="30,5 50,40 40,40 40,55 20,55 20,40 10,40" 
                            fill="${fill}" stroke="${stroke}" stroke-width="2"/>
                    </svg>
                `;
            };

            const recapDiv = document.getElementById('answersRecap');
            let html = '<h3 style="text-align: left; margin-bottom: 15px; color: #333;">D√©tail des r√©ponses</h3>';
            
            test2Answers.forEach((answer) => {
                const isCorrect = answer.isCorrect;
                const userArrowsHtml = answer.userAnswer ? `
                    <div style="display: flex; flex-direction: column; align-items: center; gap: 3px;">
                        ${createArrowSVG(answer.userAnswer.arrow1.direction, answer.userAnswer.arrow1.color, 25)}
                        ${createArrowSVG(answer.userAnswer.arrow2.direction, answer.userAnswer.arrow2.color, 25)}
                    </div>
                ` : '‚Äî';
                
                const correctArrowsHtml = `
                    <div style="display: flex; flex-direction: column; align-items: center; gap: 3px;">
                        ${createArrowSVG(answer.correctAnswer.arrow1.direction, answer.correctAnswer.arrow1.color, 25)}
                        ${createArrowSVG(answer.correctAnswer.arrow2.direction, answer.correctAnswer.arrow2.color, 25)}
                    </div>
                `;
                
                const fullRule = `${answer.rule.line1}<br>${answer.rule.line2}`;
                
                html += `
                    <div class="answer-row">
                        <div class="answer-num">#${answer.question}</div>
                        <div class="answer-operations" style="font-size: 14px;">${fullRule}</div>
                        <div class="answer-choices">
                            <div class="choice ${isCorrect ? 'user correct' : 'user incorrect'}">
                                ${userArrowsHtml}
                            </div>
                            ${!isCorrect ? `<div class="choice correct">${correctArrowsHtml}</div>` : ''}
                        </div>
                    </div>
                `;
            });
            
            recapDiv.innerHTML = html;
        }

        function newQuestion() {
            const pair = generatePair();
            operation1 = pair.op1;
            operation2 = pair.op2;
            userAnswer = null;

            document.getElementById('operation1').textContent = operation1.display;
            showScreen(2);
            updateProgress();
        }

        function showScreen(screenNum) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(`screen${screenNum}`).classList.add('active');
            
            const titleEl = document.getElementById('mainTitle');
            if (screenNum === 0) {
                titleEl.textContent = 'üìã Choix des tests';
            } else if (screenNum === 1 || screenNum === 2 || screenNum === 3 || screenNum === 4 || screenNum === 5 || screenNum === 6) {
                titleEl.textContent = 'üßÆ Aisance Num√©rique';
            } else if (screenNum === 7 || screenNum === 8 || screenNum === 9) {
                titleEl.textContent = 'üî∫ Orientation Spatiale';
            } else if (screenNum === 10 || screenNum === 11 || screenNum === 12) {
                titleEl.textContent = 'üìù M√©moire des Mots';
            } else if (screenNum === 13 || screenNum === 14) {
                titleEl.textContent = 'üß† Test de Raisonnement';
            } else if (screenNum === 15 || screenNum === 16 || screenNum === 17) {
                titleEl.textContent = 'üîç Test de Comparaison';
            }
            
            const statsBar = document.querySelector('.stats');
            if (screenNum === 0 || screenNum === 1 || screenNum === 7 || screenNum === 10 || screenNum === 13 || screenNum === 15) {
                statsBar.style.display = 'none';
            } else {
                statsBar.style.display = 'flex';
            }
        }

        function goToScreen2() {
            document.getElementById('operation2').textContent = operation2.display;
            showScreen(3);
        }

        function goToScreen3() {
            showScreen(4);
            userAnswer = null; // R√©initialise pour permettre nouvelle s√©lection
            document.querySelectorAll('.btn-answer').forEach(btn => {
                btn.classList.remove('active');
                btn.disabled = false;
            });
            document.getElementById('result').classList.remove('show');
            document.getElementById('nextBtn').style.display = 'none';
        }

        function selectAnswer(answer) {
            userAnswer = answer;
            
            // Met √† jour visuellement la s√©lection (permet de changer)
            document.getElementById(`btn${answer}`).classList.add('active');
            ['S', 'I', 'E'].filter(x => x !== answer).forEach(x => {
                document.getElementById(`btn${x}`).classList.remove('active');
            });

            // Affiche le bouton Suivant mais ne valide pas encore
            document.getElementById('result').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'block';
        }
        
        function validateAnswer() {
            // Valide la r√©ponse s√©lectionn√©e
            if (userAnswer === null) return;
            
            const correct = getCorrectAnswer();
            const isCorrect = userAnswer === correct;

            if (isCorrect) {
                score++;
                document.getElementById('correctCount').textContent = score;
            }

            answersHistory.push({
                question: currentQuestion,
                operation1: operation1.display,
                operation2: operation2.display,
                userAnswer: userAnswer,
                correctAnswer: correct,
                isCorrect: isCorrect
            });
        }

        function getCorrectAnswer() {
            if (operation1.result > operation2.result) return 'S';
            if (operation1.result < operation2.result) return 'I';
            return 'E';
        }

        function nextQuestion() {
            // Valide la r√©ponse avant de passer √† la suivante
            validateAnswer();
            
            currentQuestion++;
            document.getElementById('currentQuestion').textContent = currentQuestion;

            if (currentQuestion > TOTAL_QUESTIONS) {
                showSummary();
            } else {
                newQuestion();
            }
        }

        function updateProgress() {
            const progress = ((currentQuestion - 1) / TOTAL_QUESTIONS) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function updateTime() {
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            document.getElementById('timeDisplay').textContent = elapsed + 's';
        }

        function showSummary() {
            if (timerInterval) clearInterval(timerInterval);
            
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('summary').classList.add('show');
            document.querySelector('.stats').classList.add('show-score');
            
            document.getElementById('currentQuestion').textContent = TOTAL_QUESTIONS;

            const totalTime = Math.floor((Date.now() - startTime) / 1000);
            const avgTime = Math.floor(totalTime / TOTAL_QUESTIONS);
            const percentage = Math.round((score / TOTAL_QUESTIONS) * 100);

            document.getElementById('finalScore').textContent = `${score}/${TOTAL_QUESTIONS}`;
            document.getElementById('scorePercentage').textContent = `${percentage}% de r√©ussite`;
            document.getElementById('totalTime').textContent = totalTime + 's';
            document.getElementById('avgTime').textContent = avgTime + 's';

            let encouragement = '';
            if (percentage === 100) {
                encouragement = 'üåü Parfait ! Vous ma√Ætrisez ce test.';
            } else if (percentage >= 80) {
                encouragement = 'üëè Tr√®s bien ! Continuez √† vous entra√Æner.';
            } else if (percentage >= 60) {
                encouragement = 'üí™ Bien ! Des progr√®s encore possibles.';
            } else {
                encouragement = 'üìö Continuez vos entra√Ænements pour progresser.';
            }
            document.getElementById('encouragement').textContent = encouragement;

            displayAnswersRecap();
        }

        function displayAnswersRecap() {
            const recapDiv = document.getElementById('answersRecap');
            let html = '<h3 style="text-align: left; margin-bottom: 15px; color: #333;">D√©tail des r√©ponses</h3>';

            answersHistory.forEach((answer) => {
                const isCorrect = answer.isCorrect;
                const userChoiceClass = isCorrect ? 'user correct' : 'user incorrect';
                
                html += `
                    <div class="answer-row">
                        <div class="answer-num">#${answer.question}</div>
                        <div class="answer-operations">${answer.operation1} | ${answer.operation2}</div>
                        <div class="answer-choices">
                            <div class="choice ${userChoiceClass}">
                                ${answer.userAnswer}
                            </div>
                            ${!isCorrect ? `<div class="choice correct">${answer.correctAnswer}</div>` : ''}
                        </div>
                    </div>
                `;
            });

            recapDiv.innerHTML = html;
        }

        // ===== FONCTIONS TEST 3 (M√©moire des Mots) =====
        
        let maxTimeSeconds = 0;
        let maxQuestionsTest3 = 10;
        
        async function startTest3(value, mode) {
            test3Mode = mode;
            currentQuestion = 1;
            score = 0;
            test3Answers = [];
            startTime = Date.now();
            userAnswer3 = null;
            
            if (mode === 'questions') {
                TOTAL_QUESTIONS = value;
                test3TimeLimit = 999999;
                document.getElementById('questionsSeparator').style.display = 'inline';
                document.getElementById('totalQuestions').style.display = 'inline';
                document.getElementById('totalQuestions').textContent = value;
            } else if (mode === 'time') {
                test3TimeLimit = value;
                test3TimeRemaining = value;
                TOTAL_QUESTIONS = 9999;
                document.getElementById('questionsSeparator').style.display = 'none';
                document.getElementById('totalQuestions').style.display = 'none';
            }
            
            document.getElementById('screen12').style.display = 'block';
            
            try {
                const data = test3ThemesData;
                test3ThemesList = Object.keys(data.themes);
                
                clearInterval(timerInterval);
                if (mode === 'time') {
                    timerInterval = setInterval(() => updateCountdownTimer3(), 1000);
                    document.getElementById('timeDisplay').textContent = formatSeconds(test3TimeRemaining);
                } else {
                    test3ElapsedTime = 0;
                    document.getElementById('timeDisplay').textContent = '0s';
                    timerInterval = setInterval(() => updateElapsedTimer3(), 1000);
                }
                document.getElementById('currentQuestion').textContent = currentQuestion;
                document.getElementById('correctCount').textContent = score;
                document.getElementById('correctCount').style.display = 'inline';
                
                newQuestion3(data);
            } catch (error) {
                console.error('Erreur chargement th√®mes:', error);
                alert('Erreur lors du chargement des th√®mes');
            }
        }
        
        function updateElapsedTimer3() {
            test3ElapsedTime++;
            const displayText = formatSeconds(test3ElapsedTime);
            document.getElementById('timeDisplay').textContent = displayText;
        }
        
        function updateCountdownTimer3() {
            if (test3TimeRemaining > 0) {
                test3TimeRemaining--;
            }
            
            const displayText = formatSeconds(test3TimeRemaining);
            document.getElementById('timeDisplay').textContent = displayText;
            
            if (test3TimeRemaining <= 0) {
                clearInterval(timerInterval);
                endTest3();
            }
        }
        
        function updateCountdownTimer() {
        }
        
        function formatSeconds(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            if (mins > 0) {
                return `${mins}m ${secs}s`;
            }
            return `${secs}s`;
        }

        async function newQuestion3(data) {
            test3Themes = [];
            const themesCopy = [...test3ThemesList];
            for (let i = 0; i < 3; i++) {
                const randomIdx = Math.floor(Math.random() * themesCopy.length);
                test3Themes.push(themesCopy[randomIdx]);
                themesCopy.splice(randomIdx, 1);
            }

            const correctWords = test3Themes.map(theme => {
                const words = data.themes[theme];
                return words[Math.floor(Math.random() * words.length)];
            });
            
            test3CorrectCount = Math.floor(Math.random() * 4);
            
            const displayWords = [];
            
            test3CorrectPositions = new Set();
            if (test3CorrectCount > 0) {
                const positions = [0, 1, 2];
                for (let i = 0; i < test3CorrectCount; i++) {
                    const randomIdx = Math.floor(Math.random() * positions.length);
                    test3CorrectPositions.add(positions[randomIdx]);
                    positions.splice(randomIdx, 1);
                }
            }
            
            for (let i = 0; i < 3; i++) {
                if (test3CorrectPositions.has(i)) {
                    displayWords.push(correctWords[i]);
                } else {
                    const randomTheme = test3ThemesList[Math.floor(Math.random() * test3ThemesList.length)];
                    const words = data.themes[randomTheme];
                    let randomWord;
                    do {
                        randomWord = words[Math.floor(Math.random() * words.length)];
                    } while (correctWords.includes(randomWord) || displayWords.includes(randomWord));
                    displayWords.push(randomWord);
                }
            }
            
            test3Words = displayWords;
            
            const rulesHtml = test3Themes.join(' ‚Äî ');
            document.getElementById('rulesDisplay').textContent = rulesHtml;
            
            userAnswer3 = null;
            document.getElementById('screen12').style.display = 'none';
            document.getElementById('screen11').style.display = 'block';
            
            showScreen(11);
            document.getElementById('currentQuestion').textContent = currentQuestion;
        }

        function goToScreen12() {
            const wordsHtml = test3Words.map(w => `<div style="min-width: 100px; padding: 15px; background: white; border-radius: 6px; border: 2px solid #999;">${w}</div>`).join('');
            document.getElementById('wordsDisplay').innerHTML = wordsHtml;
            
            document.querySelectorAll('#screen12 .btn-answer').forEach(btn => {
                btn.classList.remove('selected');
                btn.style.opacity = '1';
            });
            
            document.getElementById('nextBtn3').style.display = 'none';
            
            document.getElementById('screen11').style.display = 'none';
            document.getElementById('screen12').style.display = 'block';
            
            showScreen(12);
        }

        function selectAnswer3(answer) {
            userAnswer3 = answer;
            document.querySelectorAll('#screen12 .btn-answer').forEach((btn) => {
                btn.classList.remove('active');
                if (parseInt(btn.textContent) === answer) btn.classList.add('active');
            });
            document.getElementById('nextBtn3').style.display = 'block';
        }

        async function nextQuestion3() {
            if (userAnswer3 === null) return;

            const isCorrect = userAnswer3 === test3CorrectCount;
            if (isCorrect) score++;

            test3Answers.push({
                question: currentQuestion,
                themes: test3Themes,
                words: test3Words,
                correctCount: test3CorrectCount,
                userAnswer: userAnswer3,
                isCorrect: isCorrect,
                correctPositions: Array.from(test3CorrectPositions)
            });

            currentQuestion++;
            document.getElementById('correctCount').textContent = score;

            if (currentQuestion > TOTAL_QUESTIONS) {
                endTest3();
            } else {
                const data = test3ThemesData;
                newQuestion3(data);
            }
        }

        function endTest3() {
            clearInterval(timerInterval);
            document.querySelector('.stats').classList.add('show-score');
            document.getElementById('summary').classList.add('show');
            document.getElementById('screen11').style.display = 'none';
            document.getElementById('screen12').style.display = 'none';
            
            const totalAnswers = test3Answers.length;
            
            if (test3Mode === 'questions') {
                document.getElementById('finalScore').textContent = `${score}/${totalAnswers} r√©ponses correctes`;
                document.getElementById('scorePercentage').textContent = '';
                document.getElementById('totalTime').textContent = `Temps total: ${formatSeconds(test3ElapsedTime)}`;
                document.getElementById('avgTime').textContent = `${totalAnswers} questions`;
            } else if (test3Mode === 'time') {
                const chosenTime = Math.floor(test3TimeLimit / 60);
                const timeDisplay = chosenTime === 3 ? '3 minutes' : '9 minutes';
                document.getElementById('finalScore').textContent = `${score}/${totalAnswers} r√©ponses correctes`;
                document.getElementById('scorePercentage').textContent = `en ${timeDisplay}`;
                document.getElementById('totalTime').textContent = `Dur√©e: ${timeDisplay}`;
                document.getElementById('avgTime').textContent = `${totalAnswers} r√©ponses donn√©es`;
            }

            let encouragement = '';
            if (totalAnswers > 0) {
                const percentage = Math.round((score / totalAnswers) * 100);
                if (percentage === 100) {
                    encouragement = 'üåü Parfait ! Vous ma√Ætrisez ce test.';
                } else if (percentage >= 80) {
                    encouragement = 'üëè Tr√®s bien ! Continuez √† vous entra√Æner.';
                } else if (percentage >= 60) {
                    encouragement = 'üí™ Bien ! Des progr√®s encore possibles.';
                } else {
                    encouragement = 'üìö Continuez vos entra√Ænements pour progresser.';
                }
            }
            document.getElementById('encouragement').textContent = encouragement;

            displayTest3Recap();
        }

        function displayTest3Recap() {
            const recapDiv = document.getElementById('answersRecap');
            let html = '<h3 style="text-align: center; margin-bottom: 30px; color: #333; font-size: 22px;">D√©tail des r√©ponses</h3>';

            test3Answers.forEach((answer, idx) => {
                const isCorrect = answer.isCorrect;
                const correctPosSet = new Set(answer.correctPositions);
                
                html += `
                    <div style="margin-bottom: 40px; padding: 20px; background: white; border-radius: 8px; border: 2px solid #ddd;">
                        <div style="text-align: center; margin-bottom: 20px; font-weight: bold; color: #333; font-size: 16px;">Question #${answer.question}</div>
                        
                        <div style="display: flex; justify-content: center; gap: 15px; margin-bottom: 3px;">
                            ${answer.themes.map((theme, i) => {
                                const isCorrectPair = correctPosSet.has(i);
                                const borderStyle = isCorrectPair ? '3px solid #4CAF50' : '2px solid #ccc';
                                return `<div style="min-width: 140px; padding: 15px; background: #f9f9f9; border-radius: 6px; text-align: center; font-weight: bold; font-size: 14px; border: ${borderStyle};">${theme}</div>`;
                            }).join('')}
                        </div>
                        
                        <div style="display: flex; justify-content: center; gap: 15px; margin-bottom: 20px;">
                            ${answer.words.map((word, i) => {
                                const isCorrectPair = correctPosSet.has(i);
                                const borderStyle = isCorrectPair ? '3px solid #4CAF50' : '2px solid #ccc';
                                const bgColor = isCorrectPair ? '#e8f5e9' : 'white';
                                return `<div style="min-width: 140px; padding: 15px; background: ${bgColor}; border-radius: 6px; text-align: center; font-size: 14px; border: ${borderStyle};">${word}</div>`;
                            }).join('')}
                        </div>
                        
                        <div style="display: flex; justify-content: center; gap: 40px; align-items: center;">
                            <div style="text-align: center;">
                                <div style="font-size: 12px; color: #666; margin-bottom: 8px;">Votre r√©ponse</div>
                                <div style="padding: 12px 25px; background: ${isCorrect ? '#d4edda' : '#f8d7da'}; border-radius: 6px; border: 2px solid ${isCorrect ? '#28a745' : '#dc3545'}; min-width: 60px; text-align: center; font-weight: bold; font-size: 20px;">${answer.userAnswer}</div>
                            </div>
                            ${!isCorrect ? `
                                <div style="text-align: center;">
                                    <div style="font-size: 12px; color: #666; margin-bottom: 8px;">Bonne r√©ponse</div>
                                    <div style="padding: 12px 25px; background: #d4edda; border-radius: 6px; border: 2px solid #28a745; min-width: 60px; text-align: center; font-weight: bold; font-size: 20px;">${answer.correctCount}</div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            });

            recapDiv.innerHTML = html;
        }

        // ===== FONCTIONS TEST 4 (Raisonnement) =====

        function startTest4(value, mode) {
            test4Mode = mode;
            currentQuestion = 1;
            score = 0;
            test4Answers = [];
            startTime = Date.now();
            userAnswer4 = null;
            
            if (mode === 'questions') {
                TOTAL_QUESTIONS = value;
                test4TimeLimit = 999999;
                document.getElementById('questionsSeparator').style.display = 'inline';
                document.getElementById('totalQuestions').style.display = 'inline';
                document.getElementById('totalQuestions').textContent = value;
            } else if (mode === 'time') {
                test4TimeLimit = value;
                test4TimeRemaining = value;
                TOTAL_QUESTIONS = 9999;
                document.getElementById('questionsSeparator').style.display = 'none';
                document.getElementById('totalQuestions').style.display = 'none';
            }
            
            clearInterval(timerInterval);
            if (mode === 'time') {
                timerInterval = setInterval(() => updateCountdownTimer4(), 1000);
                document.getElementById('timeDisplay').textContent = formatSeconds(test4TimeRemaining);
            } else {
                test4ElapsedTime = 0;
                document.getElementById('timeDisplay').textContent = '0s';
                timerInterval = setInterval(() => updateElapsedTimer4(), 1000);
            }
            
            document.getElementById('currentQuestion').textContent = currentQuestion;
            document.getElementById('correctCount').textContent = score;
            document.getElementById('correctCount').style.display = 'inline';
            
            newQuestion4();
        }

        function updateElapsedTimer4() {
            test4ElapsedTime++;
            document.getElementById('timeDisplay').textContent = formatSeconds(test4ElapsedTime);
        }

        function updateCountdownTimer4() {
            if (test4TimeRemaining > 0) {
                test4TimeRemaining--;
            }
            document.getElementById('timeDisplay').textContent = formatSeconds(test4TimeRemaining);
            if (test4TimeRemaining <= 0) {
                clearInterval(timerInterval);
                endTest4();
            }
        }

        function generateReasoningQuestion() {
            const themeKeys = Object.keys(test4Data.themes);
            const themeKey = themeKeys[Math.floor(Math.random() * themeKeys.length)];
            const themeElements = test4Data.themes[themeKey];
            
            const shuffled = [...themeElements].sort(() => Math.random() - 0.5);
            const elements = shuffled.slice(0, 3);
            const [A, B, C] = elements;
            
            const attribut = test4Data.attributs[Math.floor(Math.random() * test4Data.attributs.length)];
            
            const config = Math.floor(Math.random() * 4) + 1;
            
            const askMax = Math.random() < 0.5;
            
            let premise1, premise2, order, correctAnswer;
            
            const useSameComparative = Math.random() < 0.5;
            
            const capitalize = (str) => str.charAt(0).toUpperCase() + str.slice(1);
            
            switch(config) {
                case 1:
                    if (useSameComparative) {
                        premise1 = `${capitalize(A)} est plus ${attribut.positif} que ${B}`;
                        premise2 = `${capitalize(B)} est plus ${attribut.positif} que ${C}`;
                    } else {
                        premise1 = `${capitalize(A)} est plus ${attribut.positif} que ${B}`;
                        premise2 = `${capitalize(C)} est moins ${attribut.positif} que ${B}`;
                    }
                    order = [A, B, C];
                    break;
                case 2:
                    if (useSameComparative) {
                        premise1 = `${capitalize(A)} est moins ${attribut.positif} que ${B}`;
                        premise2 = `${capitalize(B)} est moins ${attribut.positif} que ${C}`;
                    } else {
                        premise1 = `${capitalize(A)} est moins ${attribut.positif} que ${B}`;
                        premise2 = `${capitalize(C)} est plus ${attribut.positif} que ${B}`;
                    }
                    order = [C, B, A];
                    break;
                case 3:
                    premise1 = `${capitalize(A)} est plus ${attribut.positif} que ${B}`;
                    premise2 = `${capitalize(C)} est moins ${attribut.positif} que ${B}`;
                    order = [A, B, C];
                    break;
                case 4:
                    premise1 = `${capitalize(A)} est moins ${attribut.positif} que ${B}`;
                    premise2 = `${capitalize(C)} est plus ${attribut.positif} que ${B}`;
                    order = [C, B, A];
                    break;
            }
            
            if (askMax) {
                correctAnswer = order[0];
            } else {
                correctAnswer = order[2];
            }
            
            const isPersonne = themeKey === 'personnes';
            const questionPrefix = isPersonne ? 'Qui est' : 'Quel est';
            const questionAttr = askMax ? attribut.questionPositif : attribut.questionNegatif;
            const question = `${questionPrefix} ${questionAttr} ?`;
            
            const choices = [...elements].sort(() => Math.random() - 0.5);
            
            return {
                premise1,
                premise2,
                question,
                choices,
                correctAnswer,
                order,
                attribut,
                askMax
            };
        }

        function newQuestion4() {
            currentTest4Question = generateReasoningQuestion();
            
            document.getElementById('premise1').textContent = currentTest4Question.premise1;
            document.getElementById('premise2').textContent = currentTest4Question.premise2;
            document.getElementById('reasoningQuestion').textContent = currentTest4Question.question;
            
            const choicesContainer = document.getElementById('reasoningChoices');
            choicesContainer.innerHTML = '';
            
            currentTest4Question.choices.forEach((choice, index) => {
                const btn = document.createElement('div');
                btn.className = 'reasoning-choice';
                btn.textContent = choice.charAt(0).toUpperCase() + choice.slice(1);
                btn.onclick = () => selectAnswer4(choice, btn);
                choicesContainer.appendChild(btn);
            });
            
            userAnswer4 = null;
            document.getElementById('nextBtn4').style.display = 'none';
            
            showScreen(14);
            document.getElementById('currentQuestion').textContent = currentQuestion;
        }

        function selectAnswer4(answer, btn) {
            userAnswer4 = answer;
            
            document.querySelectorAll('.reasoning-choice').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            
            document.getElementById('nextBtn4').style.display = 'block';
        }

        function nextQuestion4() {
            if (userAnswer4 === null) return;
            
            const isCorrect = userAnswer4 === currentTest4Question.correctAnswer;
            if (isCorrect) {
                score++;
                document.getElementById('correctCount').textContent = score;
            }
            
            test4Answers.push({
                question: currentQuestion,
                premise1: currentTest4Question.premise1,
                premise2: currentTest4Question.premise2,
                questionText: currentTest4Question.question,
                choices: currentTest4Question.choices,
                userAnswer: userAnswer4,
                correctAnswer: currentTest4Question.correctAnswer,
                isCorrect: isCorrect,
                order: currentTest4Question.order,
                askMax: currentTest4Question.askMax
            });
            
            currentQuestion++;
            
            if (currentQuestion > TOTAL_QUESTIONS) {
                endTest4();
            } else {
                newQuestion4();
            }
        }

        function endTest4() {
            clearInterval(timerInterval);
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.querySelector('.stats').classList.add('show-score');
            document.getElementById('summary').classList.add('show');
            
            const totalAnswers = test4Answers.length;
            
            if (test4Mode === 'questions') {
                document.getElementById('finalScore').textContent = `${score}/${totalAnswers}`;
                const percentage = Math.round((score / totalAnswers) * 100);
                document.getElementById('scorePercentage').textContent = `${percentage}% de r√©ussite`;
                document.getElementById('totalTime').textContent = formatSeconds(test4ElapsedTime);
                document.getElementById('avgTime').textContent = `${Math.round(test4ElapsedTime / totalAnswers)}s`;
            } else if (test4Mode === 'time') {
                const chosenTime = Math.floor(test4TimeLimit / 60);
                const timeDisplay = chosenTime === 3 ? '3 minutes' : '9 minutes';
                document.getElementById('finalScore').textContent = `${score}/${totalAnswers}`;
                const percentage = totalAnswers > 0 ? Math.round((score / totalAnswers) * 100) : 0;
                document.getElementById('scorePercentage').textContent = `${percentage}% de r√©ussite en ${timeDisplay}`;
                document.getElementById('totalTime').textContent = timeDisplay;
                document.getElementById('avgTime').textContent = `${totalAnswers} questions`;
            }
            
            let encouragement = '';
            if (totalAnswers > 0) {
                const percentage = Math.round((score / totalAnswers) * 100);
                if (percentage === 100) {
                    encouragement = 'üåü Parfait ! Vous ma√Ætrisez ce test.';
                } else if (percentage >= 80) {
                    encouragement = 'üëè Tr√®s bien ! Continuez √† vous entra√Æner.';
                } else if (percentage >= 60) {
                    encouragement = 'üí™ Bien ! Des progr√®s encore possibles.';
                } else {
                    encouragement = 'üìö Continuez vos entra√Ænements pour progresser.';
                }
            }
            document.getElementById('encouragement').textContent = encouragement;
            
            displayTest4Recap();
        }

        function displayTest4Recap() {
            const recapDiv = document.getElementById('answersRecap');
            let html = '<h3 style="text-align: center; margin-bottom: 30px; color: #333; font-size: 22px;">D√©tail des r√©ponses</h3>';

            test4Answers.forEach((answer) => {
                const isCorrect = answer.isCorrect;
                const capitalize = (str) => str.charAt(0).toUpperCase() + str.slice(1);
                
                const orderExplanation = answer.askMax 
                    ? `${capitalize(answer.order[0])} > ${capitalize(answer.order[1])} > ${capitalize(answer.order[2])}`
                    : `${capitalize(answer.order[2])} < ${capitalize(answer.order[1])} < ${capitalize(answer.order[0])}`;
                
                html += `
                    <div style="margin-bottom: 30px; padding: 20px; background: white; border-radius: 8px; border: 2px solid #ddd;">
                        <div style="text-align: center; margin-bottom: 15px; font-weight: bold; color: #333; font-size: 16px;">Question #${answer.question}</div>
                        
                        <div style="background: #f5f5f5; padding: 15px; border-radius: 6px; margin-bottom: 10px; border-left: 3px solid #667eea;">
                            <div style="font-size: 14px; color: #333; margin-bottom: 5px;">${answer.premise1}</div>
                            <div style="font-size: 14px; color: #333;">${answer.premise2}</div>
                        </div>
                        
                        <div style="background: #e8f4f8; padding: 12px; border-radius: 6px; margin-bottom: 15px; border-left: 3px solid #17a2b8; font-weight: bold; color: #333;">
                            ${answer.questionText}
                        </div>
                        
                        <div style="text-align: center; margin-bottom: 15px; font-size: 12px; color: #666;">
                            Ordre : ${orderExplanation}
                        </div>
                        
                        <div style="display: flex; justify-content: center; gap: 30px; align-items: center;">
                            <div style="text-align: center;">
                                <div style="font-size: 12px; color: #666; margin-bottom: 8px;">Votre r√©ponse</div>
                                <div style="padding: 12px 20px; background: ${isCorrect ? '#d4edda' : '#f8d7da'}; border-radius: 6px; border: 2px solid ${isCorrect ? '#28a745' : '#dc3545'}; min-width: 100px; text-align: center; font-weight: bold; font-size: 16px;">
                                    ${capitalize(answer.userAnswer)}
                                </div>
                            </div>
                            ${!isCorrect ? `
                                <div style="text-align: center;">
                                    <div style="font-size: 12px; color: #666; margin-bottom: 8px;">Bonne r√©ponse</div>
                                    <div style="padding: 12px 20px; background: #d4edda; border-radius: 6px; border: 2px solid #28a745; min-width: 100px; text-align: center; font-weight: bold; font-size: 16px;">
                                        ${capitalize(answer.correctAnswer)}
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            });

            recapDiv.innerHTML = html;
        }

        // ===== FONCTIONS TEST 5 (Comparaison de cha√Ænes) =====

        function startTest5(value, mode) {
            test5Mode = mode;
            currentQuestion = 1;
            score = 0;
            test5Answers = [];
            startTime = Date.now();
            userAnswer5 = null;
            
            if (mode === 'questions') {
                TOTAL_QUESTIONS = value;
                test5TimeLimit = 999999;
                document.getElementById('questionsSeparator').style.display = 'inline';
                document.getElementById('totalQuestions').style.display = 'inline';
                document.getElementById('totalQuestions').textContent = value;
            } else if (mode === 'time') {
                test5TimeLimit = value;
                test5TimeRemaining = value;
                TOTAL_QUESTIONS = 9999;
                document.getElementById('questionsSeparator').style.display = 'none';
                document.getElementById('totalQuestions').style.display = 'none';
            }
            
            clearInterval(timerInterval);
            if (mode === 'time') {
                timerInterval = setInterval(() => updateCountdownTimer5(), 1000);
                document.getElementById('timeDisplay').textContent = formatSeconds(test5TimeRemaining);
            } else {
                test5ElapsedTime = 0;
                document.getElementById('timeDisplay').textContent = '0s';
                timerInterval = setInterval(() => updateElapsedTimer5(), 1000);
            }
            
            document.getElementById('currentQuestion').textContent = currentQuestion;
            document.getElementById('correctCount').textContent = score;
            document.getElementById('correctCount').style.display = 'inline';
            
            newQuestion5();
        }

        function updateElapsedTimer5() {
            test5ElapsedTime++;
            document.getElementById('timeDisplay').textContent = formatSeconds(test5ElapsedTime);
        }

        function updateCountdownTimer5() {
            if (test5TimeRemaining > 0) {
                test5TimeRemaining--;
            }
            document.getElementById('timeDisplay').textContent = formatSeconds(test5TimeRemaining);
            if (test5TimeRemaining <= 0) {
                clearInterval(timerInterval);
                endTest5();
            }
        }

        // G√©n√©rateur de cha√Ænes pour Test 5
        function generateStringQuestion() {
            const stringTypes = ['email', 'url', 'plate', 'code'];
            const type = stringTypes[Math.floor(Math.random() * stringTypes.length)];
            
            let original = '';
            
            // G√©n√©rer la cha√Æne originale selon le type
            switch(type) {
                case 'email':
                    original = generateEmail();
                    break;
                case 'url':
                    original = generateUrl();
                    break;
                case 'plate':
                    original = generatePlate();
                    break;
                case 'code':
                    original = generateCode();
                    break;
            }
            
            // Distribution des erreurs: ~15% pour 0 et 4, ~23% pour 1, 2, 3
            const errorDistribution = [0, 1, 1, 1, 2, 2, 2, 3, 3, 3, 4];
            const numErrors = errorDistribution[Math.floor(Math.random() * errorDistribution.length)];
            
            // Cr√©er la copie avec des erreurs
            const { copy, errorPositions } = createCopyWithErrors(original, numErrors);
            
            return {
                original,
                copy,
                numErrors,
                errorPositions,
                type
            };
        }

        function generateEmail() {
            const letters = 'abcdefghijklmnopqrstuvwxyz';
            const digits = '0123456789';
            const domains = ['gmail.com', 'yahoo.fr', 'outlook.com', 'mail.net', 'web.org', 'pro.io', 'info.co'];
            
            // G√©n√©rer partie locale (3-8 caract√®res)
            let local = '';
            const localLength = Math.floor(Math.random() * 6) + 3;
            for (let i = 0; i < localLength; i++) {
                if (Math.random() < 0.3 && i > 0) {
                    local += digits[Math.floor(Math.random() * digits.length)];
                } else {
                    local += letters[Math.floor(Math.random() * letters.length)];
                }
            }
            
            const domain = domains[Math.floor(Math.random() * domains.length)];
            return `${local}@${domain}`;
        }

        function generateUrl() {
            const letters = 'abcdefghijklmnopqrstuvwxyz';
            const extensions = ['.com', '.org', '.net', '.fr', '.io'];
            
            // G√©n√©rer sous-domaine (4-8 caract√®res)
            let subdomain = '';
            const subLength = Math.floor(Math.random() * 5) + 4;
            for (let i = 0; i < subLength; i++) {
                subdomain += letters[Math.floor(Math.random() * letters.length)];
            }
            
            const ext = extensions[Math.floor(Math.random() * extensions.length)];
            return `http://www.${subdomain}${ext}`;
        }

        function generatePlate() {
            const letters = 'ABCDEFGHJKLMNPRSTUVWXYZ';
            const digits = '0123456789';
            
            // Formats vari√©s de plaques/codes
            const formats = [
                () => `${randomChars(letters, 3)} ${randomChars(digits, 3)}`,
                () => `${randomChars(letters, 2)}-${randomChars(digits, 3)}-${randomChars(letters, 2)}`,
                () => `${randomChars(digits, 4)} ${randomChars(letters, 2)}`,
                () => `${randomChars(letters, 1)}${randomChars(digits, 3)}${randomChars(letters, 3)}`
            ];
            
            return formats[Math.floor(Math.random() * formats.length)]();
        }

        function generateCode() {
            const letters = 'ABCDEFGHJKLMNPRSTUVWXYZ';
            const lowLetters = 'abcdefghjklmnprstuvwxyz';
            const digits = '0123456789';
            
            // Formats vari√©s de codes
            const formats = [
                () => `REF-${randomChars(digits, 4)}-${randomChars(letters, 2)}`,
                () => `${randomChars(lowLetters, 3)}${randomChars(digits, 3)}#${randomChars(lowLetters, 2)}`,
                () => `ID:${randomChars(letters, 2)}${randomChars(digits, 5)}`,
                () => `${randomChars(digits, 2)}/${randomChars(letters, 3)}/${randomChars(digits, 3)}`
            ];
            
            return formats[Math.floor(Math.random() * formats.length)]();
        }

        function randomChars(charset, length) {
            let result = '';
            for (let i = 0; i < length; i++) {
                result += charset[Math.floor(Math.random() * charset.length)];
            }
            return result;
        }

        function createCopyWithErrors(original, numErrors) {
            const letters = 'abcdefghijklmnopqrstuvwxyz';
            const upperLetters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            const digits = '0123456789';
            
            let copy = original.split('');
            const errorPositions = [];
            
            // Trouver les positions modifiables (pas les caract√®res sp√©ciaux fixes)
            const modifiablePositions = [];
            for (let i = 0; i < original.length; i++) {
                const char = original[i];
                if (/[a-zA-Z0-9]/.test(char)) {
                    modifiablePositions.push(i);
                }
            }
            
            // M√©langer et prendre numErrors positions
            const shuffled = [...modifiablePositions].sort(() => Math.random() - 0.5);
            const positionsToChange = shuffled.slice(0, Math.min(numErrors, modifiablePositions.length));
            
            positionsToChange.forEach(pos => {
                const originalChar = original[pos];
                let newChar;
                
                if (/[a-z]/.test(originalChar)) {
                    // Remplacer par une autre lettre minuscule
                    do {
                        newChar = letters[Math.floor(Math.random() * letters.length)];
                    } while (newChar === originalChar);
                } else if (/[A-Z]/.test(originalChar)) {
                    // Remplacer par une autre lettre majuscule
                    do {
                        newChar = upperLetters[Math.floor(Math.random() * upperLetters.length)];
                    } while (newChar === originalChar);
                } else if (/[0-9]/.test(originalChar)) {
                    // Remplacer par un autre chiffre
                    do {
                        newChar = digits[Math.floor(Math.random() * digits.length)];
                    } while (newChar === originalChar);
                }
                
                copy[pos] = newChar;
                errorPositions.push(pos);
            });
            
            return {
                copy: copy.join(''),
                errorPositions: errorPositions.sort((a, b) => a - b)
            };
        }

        function newQuestion5() {
            currentTest5Question = generateStringQuestion();
            
            document.getElementById('originalString').textContent = currentTest5Question.original;
            document.getElementById('copyString').textContent = currentTest5Question.copy;
            
            showScreen(16);
            document.getElementById('currentQuestion').textContent = currentQuestion;
        }

        function goToScreen17() {
            // R√©initialiser les boutons
            document.querySelectorAll('.error-count-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            userAnswer5 = null;
            document.getElementById('nextBtn5').style.display = 'none';
            
            showScreen(17);
        }

        function selectAnswer5(answer) {
            userAnswer5 = answer;
            
            document.querySelectorAll('.error-count-btn').forEach(btn => {
                btn.classList.remove('selected');
                if (parseInt(btn.textContent) === answer) {
                    btn.classList.add('selected');
                }
            });
            
            document.getElementById('nextBtn5').style.display = 'block';
        }

        function nextQuestion5() {
            if (userAnswer5 === null) return;
            
            const isCorrect = userAnswer5 === currentTest5Question.numErrors;
            if (isCorrect) {
                score++;
                document.getElementById('correctCount').textContent = score;
            }
            
            test5Answers.push({
                question: currentQuestion,
                original: currentTest5Question.original,
                copy: currentTest5Question.copy,
                numErrors: currentTest5Question.numErrors,
                errorPositions: currentTest5Question.errorPositions,
                userAnswer: userAnswer5,
                isCorrect: isCorrect
            });
            
            currentQuestion++;
            
            if (currentQuestion > TOTAL_QUESTIONS) {
                endTest5();
            } else {
                newQuestion5();
            }
        }

        function endTest5() {
            clearInterval(timerInterval);
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.querySelector('.stats').classList.add('show-score');
            document.getElementById('summary').classList.add('show');
            
            const totalAnswers = test5Answers.length;
            
            if (test5Mode === 'questions') {
                document.getElementById('finalScore').textContent = `${score}/${totalAnswers}`;
                const percentage = Math.round((score / totalAnswers) * 100);
                document.getElementById('scorePercentage').textContent = `${percentage}% de r√©ussite`;
                document.getElementById('totalTime').textContent = formatSeconds(test5ElapsedTime);
                document.getElementById('avgTime').textContent = `${Math.round(test5ElapsedTime / totalAnswers)}s`;
            } else if (test5Mode === 'time') {
                const chosenTime = Math.floor(test5TimeLimit / 60);
                const timeDisplay = chosenTime === 3 ? '3 minutes' : '9 minutes';
                document.getElementById('finalScore').textContent = `${score}/${totalAnswers}`;
                const percentage = totalAnswers > 0 ? Math.round((score / totalAnswers) * 100) : 0;
                document.getElementById('scorePercentage').textContent = `${percentage}% de r√©ussite en ${timeDisplay}`;
                document.getElementById('totalTime').textContent = timeDisplay;
                document.getElementById('avgTime').textContent = `${totalAnswers} questions`;
            }
            
            let encouragement = '';
            if (totalAnswers > 0) {
                const percentage = Math.round((score / totalAnswers) * 100);
                if (percentage === 100) {
                    encouragement = 'üåü Parfait ! Vous ma√Ætrisez ce test.';
                } else if (percentage >= 80) {
                    encouragement = 'üëè Tr√®s bien ! Continuez √† vous entra√Æner.';
                } else if (percentage >= 60) {
                    encouragement = 'üí™ Bien ! Des progr√®s encore possibles.';
                } else {
                    encouragement = 'üìö Continuez vos entra√Ænements pour progresser.';
                }
            }
            document.getElementById('encouragement').textContent = encouragement;
            
            displayTest5Recap();
        }

        function displayTest5Recap() {
            const recapDiv = document.getElementById('answersRecap');
            let html = '<h3 style="text-align: center; margin-bottom: 30px; color: #333; font-size: 22px;">D√©tail des r√©ponses</h3>';

            test5Answers.forEach((answer) => {
                const isCorrect = answer.isCorrect;
                
                // Cr√©er une version avec les erreurs surlign√©es
                let highlightedCopy = '';
                for (let i = 0; i < answer.copy.length; i++) {
                    if (answer.errorPositions.includes(i)) {
                        highlightedCopy += `<span class="char-diff">${answer.copy[i]}</span>`;
                    } else {
                        highlightedCopy += answer.copy[i];
                    }
                }
                
                html += `
                    <div style="margin-bottom: 30px; padding: 20px; background: white; border-radius: 8px; border: 2px solid #ddd;">
                        <div style="text-align: center; margin-bottom: 15px; font-weight: bold; color: #333; font-size: 16px;">Question #${answer.question}</div>
                        
                        <div style="background: #f0fff0; padding: 15px; border-radius: 6px; margin-bottom: 10px; border-left: 3px solid #28a745;">
                            <div style="font-size: 11px; color: #666; margin-bottom: 5px; text-transform: uppercase;">Originale</div>
                            <div style="font-family: 'Courier New', monospace; font-size: 16px; color: #333; letter-spacing: 1px;">${answer.original}</div>
                        </div>
                        
                        <div style="background: #fff8f0; padding: 15px; border-radius: 6px; margin-bottom: 15px; border-left: 3px solid #fd7e14;">
                            <div style="font-size: 11px; color: #666; margin-bottom: 5px; text-transform: uppercase;">Copie (erreurs surlign√©es)</div>
                            <div style="font-family: 'Courier New', monospace; font-size: 16px; color: #333; letter-spacing: 1px;">${highlightedCopy}</div>
                        </div>
                        
                        <div style="display: flex; justify-content: center; gap: 30px; align-items: center;">
                            <div style="text-align: center;">
                                <div style="font-size: 12px; color: #666; margin-bottom: 8px;">Votre r√©ponse</div>
                                <div style="padding: 12px 20px; background: ${isCorrect ? '#d4edda' : '#f8d7da'}; border-radius: 6px; border: 2px solid ${isCorrect ? '#28a745' : '#dc3545'}; min-width: 60px; text-align: center; font-weight: bold; font-size: 20px;">
                                    ${answer.userAnswer}
                                </div>
                            </div>
                            ${!isCorrect ? `
                                <div style="text-align: center;">
                                    <div style="font-size: 12px; color: #666; margin-bottom: 8px;">Bonne r√©ponse</div>
                                    <div style="padding: 12px 20px; background: #d4edda; border-radius: 6px; border: 2px solid #28a745; min-width: 60px; text-align: center; font-weight: bold; font-size: 20px;">
                                        ${answer.numErrors}
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            });

            recapDiv.innerHTML = html;
        }

        function restartTest() {
            document.getElementById('summary').classList.remove('show');
            document.querySelector('.stats').classList.remove('show-score');
            showScreen(0);
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 's' || e.key === 'S') selectAnswer('S');
            if (e.key === 'i' || e.key === 'I') selectAnswer('I');
            if (e.key === 'e' || e.key === 'E') selectAnswer('E');
            if (e.key === 'Enter') {
                if (document.getElementById('nextBtn').style.display !== 'none') nextQuestion();
                if (document.getElementById('operation1').textContent && !document.getElementById('operation2').textContent) goToScreen2();
                if (document.getElementById('operation2').textContent && userAnswer === null) goToScreen3();
            }
        });

        // Update time continuously
        timerInterval = setInterval(updateTime, 1000);

        // Show start screen on load
        showScreen(0);
    
// === GESTION DU MENU D'ACCUEIL ===
function openExitMenu() {
    document.getElementById('exitModal').classList.add('show');
}

function closeExitMenu() {
    document.getElementById('exitModal').classList.remove('show');
}

function confirmGoHome() {
    closeExitMenu();
    if (typeof currentScreen !== 'undefined') {
        currentScreen = 'home';
    }
    if (typeof showScreen === 'function') {
        showScreen('home');
    }
}

// Fermer le modal si on clique en dehors
document.addEventListener('DOMContentLoaded', function() {
    var modal = document.getElementById('exitModal');
    modal.addEventListener('click', function(event) {
        if (event.target === modal) {
            closeExitMenu();
        }
    });
});


// === SYST√àME DE CLASSEMENT ===
const leaderboardKey = 'cognitiveTestsLeaderboard';

function saveResult(testType, difficulty, playerName, score, total) {
    let leaderboard = JSON.parse(localStorage.getItem(leaderboardKey) || '{}');
    
    const key = testType + '_' + difficulty;
    if (!leaderboard[key]) {
        leaderboard[key] = [];
    }
    
    // Ajouter le nouveau r√©sultat
    leaderboard[key].push({
        name: playerName,
        score: score,
        total: total,
        time: new Date().getTime()
    });
    
    // Trier par score d√©croissant et garder top 3
    leaderboard[key].sort((a, b) => b.score - a.score);
    leaderboard[key] = leaderboard[key].slice(0, 3);
    
    localStorage.setItem(leaderboardKey, JSON.stringify(leaderboard));
}

function getLeaderboard(testType, difficulty) {
    let leaderboard = JSON.parse(localStorage.getItem(leaderboardKey) || '{}');
    const key = testType + '_' + difficulty;
    return leaderboard[key] || [];
}

function displayLeaderboard(testType, difficulty) {
    const results = getLeaderboard(testType, difficulty);
    if (results.length === 0) return '<p style="color: #999;">Aucun r√©sultat encore</p>';
    
    let html = '<div style="margin-top: 10px; padding: 15px; background-color: #f5f5f5; border-radius: 5px;">';
    html += '<h3 style="margin-top: 0; margin-bottom: 10px;">Top 3 Meilleurs R√©sultats:</h3>';
    results.forEach((result, index) => {
        html += `<div style="padding: 8px 0; border-bottom: 1px solid #ddd;">
            <strong>${index + 1}. ${result.name}</strong> - ${result.score}/${result.total}
        </div>`;
    });
    html += '</div>';
    return html;
}

</script>

<!-- Modal de confirmation -->
<div id="exitModal">
    <div class="exitModalContent">
        <h2>Voulez-vous revenir au menu principal?</h2>
        <div class="exitModalButtons">
            <button onclick="closeExitMenu()">Non</button>
            <button onclick="confirmGoHome()">Oui</button>
        </div>
    </div>
</div>

</body>
</html>
